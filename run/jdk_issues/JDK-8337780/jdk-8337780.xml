<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 09:13:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8337780] RISC-V: C2: Change C calling convention for sp to NS</title>
                <link>https://bugs.openjdk.org/browse/JDK-8337780</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>We can change the C calling convention for sp to NS as sp is always saved and restored by the prolog/epilog code.&lt;br/&gt;
This could reduce the frame size by 16 bytes for each C2 runtime stub as we do not have to save sp on the method entry. &lt;br/&gt;
Here is an example, when sp is SOE, the generated code would be:&lt;br/&gt;
```&lt;br/&gt;
Decoding RuntimeStub - _complete_monitor_locking_Java 0x0000003f676d6a08 [0x0000003f676d6a80, 0x0000003f676d6b08] (136 bytes)&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a80:   nop&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a84:   addi    sp,sp,-32&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a86:   sd      s0,16(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a88:   sd      ra,24(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a8a:   sd      sp,0(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a8c:   sd      sp,928(s7)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a90:   mv      a0,a1&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a92:   mv      a1,a2&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a94:   mv      a2,s7&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a96:   auipc   t1,0x0&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a9a:   addi    t1,t1,44 # 0x0000003f676d6ac2&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6a9e:   lui     t0,0x1fc&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6aa2:   addi    t0,t0,-108 # 0x00000000001fbf94&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6aa6:   slli    t0,t0,0xb&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6aaa:   addi    t0,t0,1589&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6aae:   slli    t0,t0,0x6&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ab2:   addi    t0,t0,14&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ab6:   addi    sp,sp,-16&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6aba:   sd      t1,8(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6abe:   jalr    t0&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ac2:   nop&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ac6:   lui     zero,0x0&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6aca:   sext.w  zero,zero&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ace:   addi    sp,sp,16&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ad2:   sd      zero,928(s7)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ad6:   sd      zero,936(s7)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ada:   ld      t2,8(s7)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ade:   bnez    t2,0x0000003f676d6aec&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ae2:   ld      sp,0(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ae4:   ld      s0,16(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ae6:   ld      ra,24(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6ae8:   addi    sp,sp,32&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6aea:   ret&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6aec:   li      t6,0&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6af0:   lui     t2,0x3f67&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6af4:   addiw   t2,t2,1487 # 0x0000000003f675cf&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6af8:   slli    t2,t2,0xc&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6afa:   addi    t2,t2,832&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6afe:   ld      sp,0(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6b00:   ld      s0,16(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6b02:   ld      ra,24(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6b04:   addi    sp,sp,32&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6b06:   jr   &lt;br/&gt;
```&lt;br/&gt;
after we change to NS, it only generates the following code:&lt;br/&gt;
```&lt;br/&gt;
Decoding RuntimeStub - _complete_monitor_locking_Java 0x0000003f676d6688 [0x0000003f676d6700, 0x0000003f676d6788] (136 bytes)&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6700:   nop&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6704:   addi    sp,sp,-16&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6706:   sd      s0,0(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6708:   sd      ra,8(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d670a:   sd      sp,928(s7)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d670e:   mv      a0,a1&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6710:   mv      a1,a2&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6712:   mv      a2,s7&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6714:   auipc   t1,0x0&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6718:   addi    t1,t1,44 # 0x0000003f676d6740&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d671c:   lui     t0,0x1fc&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6720:   addi    t0,t0,-107 # 0x00000000001fbf95&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6724:   slli    t0,t0,0xb&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6728:   addi    t0,t0,316&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d672c:   slli    t0,t0,0x6&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6730:   addi    t0,t0,12&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6734:   addi    sp,sp,-16&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6738:   sd      t1,8(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d673c:   jalr    t0&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6740:   nop&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6744:   lui     zero,0x0&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6748:   sext.w  zero,zero&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d674c:   addi    sp,sp,16&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6750:   sd      zero,928(s7)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6754:   sd      zero,936(s7)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6758:   ld      t2,8(s7)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d675c:   bnez    t2,0x0000003f676d6768&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6760:   ld      s0,0(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6762:   ld      ra,8(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6764:   addi    sp,sp,16&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6766:   ret&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6768:   li      t6,0&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d676c:   lui     t2,0x3f67&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6770:   addiw   t2,t2,1487 # 0x0000000003f675cf&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6774:   slli    t2,t2,0xc&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6776:   addi    t2,t2,832&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d677a:   ld      s0,0(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d677c:   ld      ra,8(sp)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d677e:   addi    sp,sp,16&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x0000003f676d6780:   jr      t2&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
We also checked the calling convention type for sp on other platforms (AArch64, PPC, x86, x64, S390), and they are all treated as NS.&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5136000">JDK-8337780</key>
            <summary>RISC-V: C2: Change C calling convention for sp to NS</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fjiang">Feilong Jiang</assignee>
                                    <reporter username="fjiang">Feilong Jiang</reporter>
                        <labels>
                            <label>c2</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jdk23u-fix-SQE-ok-next</label>
                            <label>jdk23u-fix-request</label>
                            <label>jdk23u-fix-yes</label>
                            <label>oraclejdk-na</label>
                    </labels>
                <created>Sat, 3 Aug 2024 04:40:54 -0700</created>
                <updated>Mon, 2 Sep 2024 17:39:59 -0700</updated>
                            <resolved>Tue, 6 Aug 2024 07:03:05 -0700</resolved>
                                    <version>24</version>
                                    <fixVersion>24</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14701700" author="roboduke" created="Thu, 29 Aug 2024 18:48:32 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk23u/pull/87&quot;&gt;https://git.openjdk.org/jdk23u/pull/87&lt;/a&gt;&lt;br/&gt;
Date: 2024-08-30 01:30:17 +0000</comment>
                            <comment id="14701699" author="roboduke" created="Thu, 29 Aug 2024 18:47:18 -0700"  >[jdk23u-fix-request] Approval Request from Fei Yang&lt;br/&gt;
Clean backport of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8337780&quot; title=&quot;RISC-V: C2: Change C calling convention for sp to NS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8337780&quot;&gt;&lt;strike&gt;JDK-8337780&lt;/strike&gt;&lt;/a&gt; to reduce frame size by 16 bytes and improve performance for some C2 runtime stubs as we do not have to save sp on the method entry. This is a RISC-V specific change. Tier1-3 tested on linux-riscv64 platform.</comment>
                            <comment id="14700438" author="roboduke" created="Sun, 25 Aug 2024 07:41:14 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: riscv-port&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/riscv-port-jdk11u/pull/26&quot;&gt;https://git.openjdk.org/riscv-port-jdk11u/pull/26&lt;/a&gt;&lt;br/&gt;
Date: 2024-08-25 14:36:24 +0000</comment>
                            <comment id="14700426" author="roboduke" created="Sat, 24 Aug 2024 19:36:18 -0700"  >[jdk17u-fix-request] Approval Request from Fei Yang&lt;br/&gt;
Clean backport of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8337780&quot; title=&quot;RISC-V: C2: Change C calling convention for sp to NS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8337780&quot;&gt;&lt;strike&gt;JDK-8337780&lt;/strike&gt;&lt;/a&gt; to reduce frame size by 16 bytes and improve performance for some C2 runtime stubs as we do not have to save sp on the method entry. This is a RISC-V specific change. Tier1-3 tested on linux-riscv64 platform.</comment>
                            <comment id="14700425" author="roboduke" created="Sat, 24 Aug 2024 19:35:08 -0700"  >[jdk21u-fix-request] Approval Request from Fei Yang&lt;br/&gt;
Clean backport of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8337780&quot; title=&quot;RISC-V: C2: Change C calling convention for sp to NS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8337780&quot;&gt;&lt;strike&gt;JDK-8337780&lt;/strike&gt;&lt;/a&gt; to reduce frame size by 16 bytes and improve performance for some C2 runtime stubs as we do not have to save sp on the method entry. This is a RISC-V specific change. Tier1-3 tested on linux-riscv64 platform.</comment>
                            <comment id="14700424" author="roboduke" created="Sat, 24 Aug 2024 19:29:59 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2823&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2823&lt;/a&gt;&lt;br/&gt;
Date: 2024-08-25 02:25:33 +0000</comment>
                            <comment id="14700423" author="roboduke" created="Sat, 24 Aug 2024 19:29:44 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/945&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/945&lt;/a&gt;&lt;br/&gt;
Date: 2024-08-25 02:25:31 +0000</comment>
                            <comment id="14696314" author="dukebot" created="Tue, 6 Aug 2024 07:03:03 -0700"  >Changeset: 53db937d&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Feilong Jiang &amp;lt;&lt;a href=&apos;mailto:fjiang@openjdk.org&apos;&gt;fjiang@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-08-06 14:01:23 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/53db937dd0766695906dc20c1dbbd3228c02fe1e&quot;&gt;https://git.openjdk.org/jdk/commit/53db937dd0766695906dc20c1dbbd3228c02fe1e&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14695615" author="roboduke" created="Sat, 3 Aug 2024 09:22:02 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/20449&quot;&gt;https://git.openjdk.org/jdk/pull/20449&lt;/a&gt;&lt;br/&gt;
Date: 2024-08-03 16:17:53 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5138243">JDK-8339388</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5138252">JDK-8339397</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5138253">JDK-8339398</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="20300"><![CDATA[riscv]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37fpv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17338"><![CDATA[b10]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>