<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 10:22:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8327370] (ch) sun.nio.ch.Poller.register throws AssertionError</title>
                <link>https://bugs.openjdk.org/browse/JDK-8327370</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>java.lang.AssertionError&lt;br/&gt;
	at java.base/sun.nio.ch.Poller.register(Poller.java:192)&lt;br/&gt;
	at java.base/sun.nio.ch.Poller.poll(Poller.java:171)&lt;br/&gt;
	at java.base/sun.nio.ch.Poller.poll(Poller.java:137)&lt;br/&gt;
	at java.base/sun.nio.ch.DatagramChannelImpl.park(DatagramChannelImpl.java:494)&lt;br/&gt;
	at java.base/sun.nio.ch.SelChImpl.park(SelChImpl.java:116)&lt;br/&gt;
	at java.base/sun.nio.ch.DatagramChannelImpl.untrustedReceive(DatagramChannelImpl.java:646)&lt;br/&gt;
	at java.base/sun.nio.ch.DatagramChannelImpl.receive(DatagramChannelImpl.java:599)&lt;br/&gt;
&lt;br/&gt;
From the traces I managed to obtain after adding a debug message to the AssertionError, it seems that a terminated virtual thread is still registered with the poller at the time a runnable VirtualThread tries to register.</description>
                <environment></environment>
        <key id="5123289">JDK-8327370</key>
            <summary>(ch) sun.nio.ch.Poller.register throws AssertionError</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dfuchs">Daniel Fuchs</assignee>
                                    <reporter username="dfuchs">Daniel Fuchs</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>noreg-hard</label>
                    </labels>
                <created>Tue, 5 Mar 2024 04:33:39 -0800</created>
                <updated>Fri, 11 Apr 2025 07:24:27 -0700</updated>
                            <resolved>Fri, 21 Jun 2024 02:45:18 -0700</resolved>
                                    <version>21</version>
                    <version>23</version>
                                    <fixVersion>24</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14768270" author="roboduke" created="Tue, 8 Apr 2025 12:05:27 -0700"  >[jdk21u-fix-request] Approval Request from Satyen Subramaniam&lt;br/&gt;
for backport. Fixes an intermittent AssertionError observed in sun.nio.ch.Poller by removing a value attempting to be registered in cases where an exception is thrown during the registration process.&lt;br/&gt;
&lt;br/&gt;
Risk: Low. Minor change that should only affect behavior in cases where exception is thrown. Fix merged in June of 2024 in tip.&lt;br/&gt;
&lt;br/&gt;
Testing: &lt;br/&gt;
* GHA Sanity Checks&lt;br/&gt;
* Tier 1 and 2 tests locally</comment>
                            <comment id="14768247" author="roboduke" created="Tue, 8 Apr 2025 11:05:02 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1617&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1617&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-08 17:55:45 +0000</comment>
                            <comment id="14684213" author="shade" created="Mon, 24 Jun 2024 10:49:24 -0700"  >Looks to me, this fixes the original code integrated in JDK 19, so JDK 21 is also affected.</comment>
                            <comment id="14683596" author="dukebot" created="Fri, 21 Jun 2024 02:45:17 -0700"  >Changeset: d2bebffb&lt;br/&gt;
Author:    Daniel Fuchs &amp;lt;&lt;a href=&apos;mailto:dfuchs@openjdk.org&apos;&gt;dfuchs@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-06-21 09:43:49 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/d2bebffb1fd26fae4526afd33a818ee776b7102e&quot;&gt;https://git.openjdk.org/jdk/commit/d2bebffb1fd26fae4526afd33a818ee776b7102e&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14683182" author="roboduke" created="Thu, 20 Jun 2024 03:52:09 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/19792&quot;&gt;https://git.openjdk.org/jdk/pull/19792&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-19 13:36:03 +0000</comment>
                            <comment id="14682151" author="dfuchs" created="Mon, 17 Jun 2024 10:15:14 -0700"  >That was my intended fix. </comment>
                            <comment id="14682149" author="alanb" created="Mon, 17 Jun 2024 10:11:50 -0700"  >Poller.register is changed in the loom repo to remove the key when the underlying registers fails. We should bring that change into the main line.</comment>
                            <comment id="14677170" author="alanb" created="Wed, 29 May 2024 04:20:50 -0700"  >If implRegister fails (maybe kqueue fails with a resource error such as ENOMEM?) then it should, as [~djelinski] suggested, should remove the fd from the map.</comment>
                            <comment id="14655772" author="dfuchs" created="Fri, 8 Mar 2024 02:19:41 -0800"  >I see no StackOverflow. For some reason it seems to trigger always with the same test. I am not sure about the async close - the assertion happens during the handshake. Oh - I see - we have an old HTTP Client that had registered for fdval=30, and then we have a new HTTP Client that registers for the same fdval=30, presumably because the new socket got the same file descriptor than the old socket.&lt;br/&gt;
&lt;br/&gt;
So indeed this seems to be related to async close, where the socket opened by the new client has the same file descriptor value than the old one which has been closed.&lt;br/&gt;
&lt;br/&gt;
Note: he test is running twice in /othervm, once with security manager, once without, and I saw the AssertionError in both cases.  So I don&amp;#39;t believe we can ascribe this to the presence of a SecurityManager.</comment>
                            <comment id="14655760" author="alanb" created="Fri, 8 Mar 2024 02:00:37 -0800"  >[~dfuchs] Can you check a StackOverflowError has been encountered? If it&amp;#39;s not SOE then it may be related to async close as there are still some changes needed in that area.&lt;br/&gt;
&lt;br/&gt;
(It would be nice to have a small/standalone test case).</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5155656">JDK-8354429</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17008"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17017"><![CDATA[os_x]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35aj7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17314"><![CDATA[b04]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="228"><![CDATA[java.nio]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>