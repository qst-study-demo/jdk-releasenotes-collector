<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 10:12:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8313290] Misleading exception message from STS.Subtask::get when task forked after shutdown</title>
                <link>https://bugs.openjdk.org/browse/JDK-8313290</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>ADDITIONAL SYSTEM INFORMATION :&lt;br/&gt;
Ubuntu 22.04&lt;br/&gt;
openjdk 21-ea 2023-09-19&lt;br/&gt;
OpenJDK Runtime Environment (build 21-ea+32-2482)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 21-ea+32-2482, mixed mode, sharing)&lt;br/&gt;
&lt;br/&gt;
A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
When using a StructuredTaskScope after shutdown, I get a misleading error message when calling Subtask.get(): &amp;quot;IllegalStateException: Owner did not join after forking subtasks&amp;quot;.&lt;br/&gt;
&lt;br/&gt;
See example code below. In the code, join() is called right before Subtask.get(), so the error message is clearly not incorrect (in addition to not being helpful).&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;d expect an exception that indicates that the StructuredTaskScope is already shutdown.&lt;br/&gt;
&lt;br/&gt;
Obviously, this is a rather unlikely usage pattern (shutdown() + fork()), but there might be more meaningful cases where this occurs, and then a better exception message might be helpful.&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
See example code.&lt;br/&gt;
&lt;br/&gt;
EXPECTED VERSUS ACTUAL BEHAVIOR :&lt;br/&gt;
EXPECTED -&lt;br/&gt;
An exception that indicates that the StructuredTaskScope is shutdown.&lt;br/&gt;
ACTUAL -&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.IllegalStateException: Owner did not join after forking subtasks&lt;br/&gt;
	at java.base/java.util.concurrent.StructuredTaskScope.newIllegalStateExceptionNoJoin(StructuredTaskScope.java:439)&lt;br/&gt;
	at java.base/java.util.concurrent.StructuredTaskScope.ensureJoinedIfOwner(StructuredTaskScope.java:477)&lt;br/&gt;
	at java.base/java.util.concurrent.StructuredTaskScope$SubtaskImpl.get(StructuredTaskScope.java:927)&lt;br/&gt;
	at com.example.Test.main(Test.java:17)&lt;br/&gt;
&lt;br/&gt;
---------- BEGIN SOURCE ----------&lt;br/&gt;
&lt;br/&gt;
import java.util.concurrent.ExecutionException;&lt;br/&gt;
import java.util.concurrent.StructuredTaskScope;&lt;br/&gt;
&lt;br/&gt;
public class Test {&lt;br/&gt;
&lt;br/&gt;
	public static void main(String[] args) {&lt;br/&gt;
		try (var scope = new StructuredTaskScope.ShutdownOnFailure()) {&lt;br/&gt;
&lt;br/&gt;
			scope.shutdown();&lt;br/&gt;
&lt;br/&gt;
			StructuredTaskScope.Subtask&amp;lt;String&amp;gt; subtask = scope.fork(() -&amp;gt; &amp;quot;result&amp;quot;);&lt;br/&gt;
&lt;br/&gt;
			scope.join().throwIfFailed();&lt;br/&gt;
&lt;br/&gt;
			subtask.get(); // IllegalStateException: Owner did not join after forking subtasks&lt;br/&gt;
&lt;br/&gt;
		} catch (InterruptedException | ExecutionException e) {&lt;br/&gt;
			throw new RuntimeException(e);&lt;br/&gt;
		}&lt;br/&gt;
	}&lt;br/&gt;
&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
---------- END SOURCE ----------&lt;br/&gt;
&lt;br/&gt;
FREQUENCY : always&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5106810">JDK-8313290</key>
            <summary>Misleading exception message from STS.Subtask::get when task forked after shutdown</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alanb">Alan Bateman</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>21ea</label>
                            <label>amazon-interest</label>
                            <label>dcsaw</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>loom</label>
                            <label>reproducer-yes</label>
                            <label>webbug</label>
                    </labels>
                <created>Thu, 27 Jul 2023 10:10:48 -0700</created>
                <updated>Fri, 9 May 2025 20:23:21 -0700</updated>
                            <resolved>Sat, 19 Aug 2023 11:43:57 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>22</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14774364" author="roboduke" created="Mon, 28 Apr 2025 15:19:01 -0700"  >[jdk21u-fix-request] Approval Request from Daniel Hu&lt;br/&gt;
Fixes StructuredTaskScope.get exception giving a misleading message in certain scenarios. Applies cleanly. Patched in JDK22, and no known bugs from this change. Affected test passes with the change. Risk is low given the minor change and length of time in mainline.</comment>
                            <comment id="14774363" author="roboduke" created="Mon, 28 Apr 2025 15:18:27 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1720&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1720&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-28 17:41:01 +0000</comment>
                            <comment id="14605152" author="dukebot" created="Sat, 19 Aug 2023 11:43:56 -0700"  >Changeset: ed0f75f2&lt;br/&gt;
Author:    Alan Bateman &amp;lt;&lt;a href=&apos;mailto:alanb@openjdk.org&apos;&gt;alanb@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-08-19 18:42:43 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/ed0f75f2666f61ec3d8ccb78594a21db9f1be50a&quot;&gt;https://git.openjdk.org/jdk/commit/ed0f75f2666f61ec3d8ccb78594a21db9f1be50a&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14604256" author="roboduke" created="Tue, 15 Aug 2023 23:50:49 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/15076&quot;&gt;https://git.openjdk.org/jdk/pull/15076&lt;/a&gt;&lt;br/&gt;
Date: 2023-07-28 20:33:01 +0000</comment>
                            <comment id="14600051" author="alanb" created="Fri, 28 Jul 2023 13:14:44 -0700"  >If a task is forked when the scope is shutdown then the implementation doesn&amp;#39;t force a join when it&amp;#39;s the first task forked in a new round of forking. Calling Subtask::get correctly throws ISE, it&amp;#39;s just that it doesn&amp;#39;t hasn&amp;#39;t recorded that join has been called.</comment>
                            <comment id="14599777" author="tongwan" created="Thu, 27 Jul 2023 21:51:21 -0700"  >The observations on Windows 11:&lt;br/&gt;
JDK 21ea+33: Failed, IllegalStateException observed. </comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5158322">JDK-8356672</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="104808" name="Test.java" size="620" author="tongwan" created="Thu, 27 Jul 2023 21:52:19 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17008"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17010"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32iyj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17349"><![CDATA[b12]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="215"><![CDATA[java.util.concurrent]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>