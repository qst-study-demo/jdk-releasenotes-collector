<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 10:45:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8344361] Restore null return for invalid services from legacy providers</title>
                <link>https://bugs.openjdk.org/browse/JDK-8344361</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
In Provider.java around line 1285, the following code exists.&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Service s = serviceMap.get(key);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (s == null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;s = legacyMap.get(key);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (s != null &amp;amp;&amp;amp; !s.isValid()) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;legacyMap.remove(key, s);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
There needs to be a &amp;quot;s = null;&amp;quot; after legacyMap.remove() as otherwise a service which fails  the isValid() test will be returned as is resulting in a failure later.&lt;br/&gt;
&lt;br/&gt;
Unfortunately this appears to happen with providers using the legacy format which results in NullPointerException further down the track when the JCA tries to create an object using a Service with a null class name. It&amp;#39;s not immediately clear how legacy parsing is resulting in the invalid services, but they are created with a null class name. For what it&amp;#39;s worth this has only started happening with Java 21.&lt;br/&gt;
&lt;br/&gt;
REGRESSION : Last worked in version 17.0.13&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
Requesting an algorithm which does not exist will cause this to happen (sometimes). It also seems to get triggered when attempts are made to match keys to signature providers which we think is why it shows up with the PKCS11 provider.&lt;br/&gt;
&lt;br/&gt;
The code is incorrect by inspection though, if s.isValid() is false s should be getting returned as null, not as an invalid service class.&lt;br/&gt;
&lt;br/&gt;
EXPECTED VERSUS ACTUAL BEHAVIOR :&lt;br/&gt;
EXPECTED -&lt;br/&gt;
Request for a service which cannot be fully constructed should result in a NoSuchAlgorithmException not a NullPointerException.&lt;br/&gt;
ACTUAL -&lt;br/&gt;
NullPointerException&lt;br/&gt;
&lt;br/&gt;
CUSTOMER SUBMITTED WORKAROUND :&lt;br/&gt;
Catching NullPointerException and hoping it can be treated like NoSuchAlgorithmException.&lt;br/&gt;
&lt;br/&gt;
FREQUENCY : always&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5144078">JDK-8344361</key>
            <summary>Restore null return for invalid services from legacy providers</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coffeys">Sean Coffey</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>dcsaw</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jdk24u-fix-SQE-ok</label>
                            <label>jdk24u-fix-request</label>
                            <label>jdk24u-fix-yes</label>
                            <label>regression</label>
                            <label>reproducer-other</label>
                            <label>starter-bug</label>
                            <label>webbug</label>
                    </labels>
                <created>Sat, 16 Nov 2024 15:05:30 -0800</created>
                <updated>Fri, 25 Apr 2025 14:05:24 -0700</updated>
                            <resolved>Fri, 24 Jan 2025 02:44:39 -0800</resolved>
                                    <version>17</version>
                    <version>20</version>
                    <version>21</version>
                    <version>24</version>
                                    <fixVersion>25</fixVersion>
                                    <component>security-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14768121" author="roboduke" created="Tue, 8 Apr 2025 06:32:36 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/3453&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/3453&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-08 13:24:17 +0000</comment>
                            <comment id="14768114" author="goetz" created="Tue, 8 Apr 2025 06:23:52 -0700"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
I backport this to fix the issue introduced by backport of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8276660&quot; title=&quot;Scalability bottleneck in java.security.Provider.getService()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8276660&quot;&gt;&lt;strike&gt;JDK-8276660&lt;/strike&gt;&lt;/a&gt; to 17.0.13.&lt;br/&gt;
Acceptable risk, trivial change.&lt;br/&gt;
Clean backport.&lt;br/&gt;
Test passes and reproduces the issue without the fix. SAP nightly testing passed.</comment>
                            <comment id="14767269" author="roboduke" created="Fri, 4 Apr 2025 14:03:30 -0700"  >[jdk21u-fix-request] Approval Request from Paul Hohensee&lt;br/&gt;
Backport for parity with Oracle 21.0.8. Clean, low risk: obvious bug, updated and new test pass, Provider tests pass: test/jdk/java/security/Provider and test/jdk/sun/security/pkcs11/Provider.</comment>
                            <comment id="14767250" author="roboduke" created="Fri, 4 Apr 2025 12:37:13 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1600&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1600&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-04 19:30:16 +0000</comment>
                            <comment id="14767239" author="roboduke" created="Fri, 4 Apr 2025 11:57:20 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1597&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1597&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-04 18:50:08 +0000</comment>
                            <comment id="14743455" author="roboduke" created="Fri, 24 Jan 2025 08:56:43 -0800"  >[jdk24u-fix-request] Approval Request from Se&amp;#xE1;n Coffey&lt;br/&gt;
Correct a recent regression</comment>
                            <comment id="14743402" author="roboduke" created="Fri, 24 Jan 2025 08:13:20 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk24u/pull/31&quot;&gt;https://git.openjdk.org/jdk24u/pull/31&lt;/a&gt;&lt;br/&gt;
Date: 2025-01-24 16:06:33 +0000</comment>
                            <comment id="14743016" author="dukebot" created="Fri, 24 Jan 2025 02:44:38 -0800"  >Changeset: e20bd018&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Sean Coffey &amp;lt;&lt;a href=&apos;mailto:coffeys@openjdk.org&apos;&gt;coffeys@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2025-01-24 10:40:36 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/e20bd018c4046870d0cf632bb8e5440cb9f5c3c2&quot;&gt;https://git.openjdk.org/jdk/commit/e20bd018c4046870d0cf632bb8e5440cb9f5c3c2&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14741121" author="roboduke" created="Mon, 20 Jan 2025 08:13:27 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/23201&quot;&gt;https://git.openjdk.org/jdk/pull/23201&lt;/a&gt;&lt;br/&gt;
Date: 2025-01-20 16:06:56 +0000</comment>
                            <comment id="14741117" author="coffeys" created="Mon, 20 Jan 2025 08:02:04 -0800"  >Code without the &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8276660&quot; title=&quot;Scalability bottleneck in java.security.Provider.getService()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8276660&quot;&gt;&lt;strike&gt;JDK-8276660&lt;/strike&gt;&lt;/a&gt; fix doesn&amp;#39;t appear to be affected</comment>
                            <comment id="14729076" author="coffeys" created="Thu, 5 Dec 2024 11:37:25 -0800"  >pre &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8254711&quot; title=&quot;Add java.security.Provider.getService JFR Event&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8254711&quot;&gt;&lt;strike&gt;JDK-8254711&lt;/strike&gt;&lt;/a&gt; code was effectively: &lt;br/&gt;
&lt;br/&gt;
simplified view: &lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;s = legacyMap.get(key);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (s != null &amp;amp;&amp;amp; !s.isValid()) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;legacyMap.remove(key, s);&lt;br/&gt;
			return null;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} else {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return s;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
		&lt;br/&gt;
	&lt;br/&gt;
***&lt;br/&gt;
&lt;br/&gt;
post &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8254711&quot; title=&quot;Add java.security.Provider.getService JFR Event&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8254711&quot;&gt;&lt;strike&gt;JDK-8254711&lt;/strike&gt;&lt;/a&gt; code:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Service s = serviceMap.get(key);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (s == null) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;s = legacyMap.get(key);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (s != null &amp;amp;&amp;amp; !s.isValid()) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;legacyMap.remove(key, s);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// some JFR code if JFR turned on&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return s;&lt;br/&gt;
		&lt;br/&gt;
**&lt;br/&gt;
&lt;br/&gt;
yes, a null return should be made in the !s.isValid() case.&lt;br/&gt;
can add a &amp;quot;return null&amp;quot; call after the legacyMap.remove call.</comment>
                            <comment id="14722986" author="tongwan" created="Sun, 17 Nov 2024 04:46:53 -0800"  >Looks like the issue is related to &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8254711&quot; title=&quot;Add java.security.Provider.getService JFR Event&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8254711&quot;&gt;&lt;strike&gt;JDK-8254711&lt;/strike&gt;&lt;/a&gt;.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5149325">JDK-8348842</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5149329">JDK-8348846</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5155071">JDK-8353894</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5155648">JDK-8354421</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10600">
                    <name>Causes</name>
                                                                <inwardlinks description="caused by">
                                        <issuelink>
            <issuekey id="5062024">JDK-8276660</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5032083">JDK-8254711</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5144981">JDK-8345139</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17008"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10003" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Introduced In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17459"><![CDATA[b17]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22023">20</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17010"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38qnf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17337"><![CDATA[b08]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="195"><![CDATA[java.security]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>