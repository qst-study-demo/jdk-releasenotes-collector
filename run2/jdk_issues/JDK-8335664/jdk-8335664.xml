<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 09:10:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8335664] Parsing jsr broken: assert(bci&gt;= 0 &amp;&amp; bci &lt; c-&gt;method()-&gt;code_size()) failed: index out of bounds</title>
                <link>https://bugs.openjdk.org/browse/JDK-8335664</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>If you fix this bug: please mention me, I spent quite some time extracting the JASM file for you to have a simple reproducer ;)&lt;br/&gt;
&lt;br/&gt;
Affected:&lt;br/&gt;
JDK23 - JDK11, maybe further back (did not check more).&lt;br/&gt;
&lt;br/&gt;
Product gives us:&lt;br/&gt;
Error: Unable to initialize main class TestClassNew&lt;br/&gt;
Caused by: java.lang.LinkageError: Illegal class file encountered. Try running with -Xverify:all in method main&lt;br/&gt;
&lt;br/&gt;
Debug reproduces/asserts immediately.&lt;br/&gt;
&lt;a href=&apos;mailto:emanuel@emanuel-oracle&apos;&gt;emanuel@emanuel-oracle&lt;/a&gt;:xyz$ java -jar ~/Documents/asmtools-7.0-build/release/lib/asmtools.jar jasm Test.jasm&lt;br/&gt;
&lt;a href=&apos;mailto:emanuel@emanuel-oracle&apos;&gt;emanuel@emanuel-oracle&lt;/a&gt;:xyz$ /oracle-work/jdk-fork2/build/linux-x64-debug/jdk/bin/java Test&lt;br/&gt;
&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (/oracle-work/jdk-fork2/open/src/hotspot/share/oops/generateOopMap.cpp:401), pid=3707675, tid=3707676&lt;br/&gt;
#  assert(bci&amp;gt;= 0 &amp;amp;&amp;amp; bci &amp;lt; c-&amp;gt;method()-&amp;gt;code_size()) failed: index out of bounds&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (24.0) (fastdebug build 24-internal-2024-06-13-1913126.emanuel...)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 24-internal-2024-06-13-1913126.emanuel..., mixed mode, tiered, compressed oops, compressed class ptrs, g1 gc, linux-amd64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# V  [libjvm.so+0xd5b5c8]  GenerateOopMap::bb_mark_fct(GenerateOopMap*, int, int*) [clone .part.0]+0x28&lt;br/&gt;
#&lt;br/&gt;
# Core dump will be written. Default location: Core dumps may be processed with &amp;quot;/usr/share/apport/apport -p%p -s%s -c%c -d%d -P%P -u%u -g%g -- %E&amp;quot; (or dumping to /oracle-work/???/files-for-report/24-13/core.3707675)&lt;br/&gt;
#&lt;br/&gt;
# If you would like to submit a bug report, please visit:&lt;br/&gt;
#   &lt;a href=&quot;https://bugreport.java.com/bugreport/crash.jsp&quot;&gt;https://bugreport.java.com/bugreport/crash.jsp&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
bci = 39, c-&amp;gt;method()-&amp;gt;code_size() = 39&lt;br/&gt;
&lt;br/&gt;
We are at bci 36, where the jsr bytecode is. Then, we want to step the length of that bytecode forward, i.e. +3, and mark the bci there as a block header. But that is the end of the code, i.e. there is nothing after the jsr.&lt;br/&gt;
&lt;br/&gt;
I extracted a simple JASM test:&lt;br/&gt;
&lt;br/&gt;
super public class Test&lt;br/&gt;
{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public static Method main:&amp;quot;([Ljava/lang/String;)V&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;stack 100 locals 100&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;LABEL:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;nop;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;jsr LABEL; // bci=2. Compute bci + length(jsr) -&amp;gt; bci = 5 accessed, out of bounds.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
}</description>
                <environment></environment>
        <key id="5133430">JDK-8335664</key>
            <summary>Parsing jsr broken: assert(bci&gt;= 0 &amp;&amp; bci &lt; c-&gt;method()-&gt;code_size()) failed: index out of bounds</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="matsaave">Matias Saavedra Silva</assignee>
                                    <reporter username="epeter">Emanuel Peter</reporter>
                        <labels>
                            <label>interpreter</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jdk23u-fix-SQE-ok-next</label>
                            <label>jdk23u-fix-request</label>
                            <label>jdk23u-fix-yes</label>
                    </labels>
                <created>Thu, 4 Jul 2024 00:11:03 -0700</created>
                <updated>Tue, 1 Oct 2024 03:37:55 -0700</updated>
                            <resolved>Thu, 22 Aug 2024 08:56:03 -0700</resolved>
                                    <version>11</version>
                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                    <version>23</version>
                    <version>24</version>
                                    <fixVersion>24</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14708063" author="roboduke" created="Thu, 26 Sep 2024 01:11:36 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1012&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1012&lt;/a&gt;&lt;br/&gt;
Date: 2024-09-26 08:02:56 +0000</comment>
                            <comment id="14708056" author="goetz" created="Thu, 26 Sep 2024 01:02:14 -0700"  >Fix request [21u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 21.0.6-oracle.&lt;br/&gt;
Medium risk, as this is a change to a central component that already caused a regression. It introduces a new case where C1 aborts compilation.&lt;br/&gt;
But it has a good repro case and I think we should follow Oracle.&lt;br/&gt;
Clean backport including &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8338924&quot; title=&quot;C1: assert(0 &amp;lt;= i &amp;amp;&amp;amp; i &amp;lt; _len) failed: illegal index 5 for length 5&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8338924&quot;&gt;&lt;strike&gt;JDK-8338924&lt;/strike&gt;&lt;/a&gt; from 23.&lt;br/&gt;
Test passes and fails without the fix. SAP nightly testing passed.&lt;br/&gt;
</comment>
                            <comment id="14708055" author="goetz" created="Thu, 26 Sep 2024 01:00:14 -0700"  >This change introduced a regression fixed by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8335664&quot; title=&quot;Parsing jsr broken: assert(bci&amp;gt;= 0 &amp;amp;&amp;amp; bci &amp;lt; c-&amp;gt;method()-&amp;gt;code_size()) failed: index out of bounds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8335664&quot;&gt;&lt;strike&gt;JDK-8335664&lt;/strike&gt;&lt;/a&gt;.</comment>
                            <comment id="14708050" author="goetz" created="Thu, 26 Sep 2024 00:28:59 -0700"  >The assertion that detects the issue was added by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8283441&quot; title=&quot;C2: segmentation fault in ciMethodBlocks::make_block_at(int)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8283441&quot;&gt;&lt;strike&gt;JDK-8283441&lt;/strike&gt;&lt;/a&gt;.</comment>
                            <comment id="14706312" author="roboduke" created="Thu, 19 Sep 2024 12:29:15 -0700"  >[jdk23u-fix-request] Approval Request from Matias Saavedra Silva&lt;br/&gt;
</comment>
                            <comment id="14706300" author="roboduke" created="Thu, 19 Sep 2024 11:29:51 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk23u/pull/109&quot;&gt;https://git.openjdk.org/jdk23u/pull/109&lt;/a&gt;&lt;br/&gt;
Date: 2024-09-19 18:23:01 +0000</comment>
                            <comment id="14700079" author="dukebot" created="Thu, 22 Aug 2024 08:56:01 -0700"  >Changeset: 6041c936&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Matias Saavedra Silva &amp;lt;&lt;a href=&apos;mailto:matsaave@openjdk.org&apos;&gt;matsaave@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-08-22 15:55:02 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/6041c936d6dd39c5b3a89ed2823b25a8aef42b9f&quot;&gt;https://git.openjdk.org/jdk/commit/6041c936d6dd39c5b3a89ed2823b25a8aef42b9f&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14699460" author="roboduke" created="Tue, 20 Aug 2024 07:22:02 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/20645&quot;&gt;https://git.openjdk.org/jdk/pull/20645&lt;/a&gt;&lt;br/&gt;
Date: 2024-08-20 14:12:55 +0000</comment>
                            <comment id="14687153" author="thartmann" created="Thu, 4 Jul 2024 07:47:20 -0700"  >The assert happens during bytecode rewriting in the interpreter (also happens with -Xint). Moving this to hotspot/runtime for now.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5139997">JDK-8340953</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5140002">JDK-8340958</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5140420">JDK-8341323</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5070500">JDK-8283441</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5137422">JDK-8338924</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="109951" name="Test.class" size="159" author="epeter" created="Thu, 4 Jul 2024 00:10:41 -0700"/>
                            <attachment id="109950" name="Test.jasm" size="251" author="epeter" created="Thu, 4 Jul 2024 00:10:41 -0700"/>
                            <attachment id="109952" name="hs_err_pid3707675.log" size="85329" author="epeter" created="Thu, 4 Jul 2024 00:10:41 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i370fv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17339"><![CDATA[b13]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>