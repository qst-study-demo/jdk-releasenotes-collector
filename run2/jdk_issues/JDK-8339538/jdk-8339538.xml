<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 10:31:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8339538] Wrong timeout computations in DnsClient</title>
                <link>https://bugs.openjdk.org/browse/JDK-8339538</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The following issues related to timeout computation in the &amp;#39;com.sun.jndi.dns.DnsClient&amp;#39; code have been reported here:&lt;br/&gt;
&lt;a href=&quot;https://mail.openjdk.org/pipermail/core-libs-dev/2024-September/128797.html&quot;&gt;https://mail.openjdk.org/pipermail/core-libs-dev/2024-September/128797.html&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
1. Non-monotonic time source is used to calculate the duration of receive operation:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;       long start = System.currentTimeMillis();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;gotData = blockingReceive(udpChannel, ipkt, timeoutLeft);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;long end = System.currentTimeMillis();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.currentTimeMillis() is not monotonic and therefore it could happen that end - start &amp;lt; 0&amp;quot;&lt;br/&gt;
&lt;br/&gt;
2. Left timeout value is not correctly decreased:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;quot;int timeoutLeft = pktTimeout;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;do {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#8194;&#8194;&#8194;&#8194;&#8194;&#8194;timeoutLeft = pktTimeout - ((int) (end - start));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} while (timeoutLeft &amp;gt; MIN_TIMEOUT);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Here, timeoutLeft is not iteratively decreased, but is always derived from `pktTimeout`.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;I can see a case where `timeoutLeft` never drops below `MIN_TIMEOUT` (this is the part where I&amp;#39;m not sure if I&amp;#39;m missing some deeper knowledge).&amp;quot;</description>
                <environment></environment>
        <key id="5138407">JDK-8339538</key>
            <summary>Wrong timeout computations in DnsClient</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aefimov">Aleksej Efimov</assignee>
                                    <reporter username="dfuchs">Daniel Fuchs</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                    </labels>
                <created>Wed, 4 Sep 2024 06:08:48 -0700</created>
                <updated>Fri, 4 Apr 2025 06:33:50 -0700</updated>
                            <resolved>Thu, 10 Oct 2024 08:59:31 -0700</resolved>
                                                    <fixVersion>24</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14766464" author="roboduke" created="Wed, 2 Apr 2025 14:51:25 -0700"  >[jdk21u-fix-request] Approval Request from Paul Hohensee&lt;br/&gt;
Backport for parity with Oracle 21.0.8. Tier2 (includes jndi/dns tests) and modified/new tests pass. Low risk: DnsClient and Timeout test modified to use nano clock, Timeout test modified to increase allowed allowed difference between observed and actual timeout.</comment>
                            <comment id="14766381" author="roboduke" created="Wed, 2 Apr 2025 09:45:50 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1575&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1575&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-02 16:36:05 +0000</comment>
                            <comment id="14711930" author="dukebot" created="Thu, 10 Oct 2024 08:59:27 -0700"  >Changeset: 4beb7719&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Aleksei Efimov &amp;lt;&lt;a href=&apos;mailto:aefimov@openjdk.org&apos;&gt;aefimov@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-10-10 15:56:04 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/4beb77192f54f27183285400d7cae7528df64e43&quot;&gt;https://git.openjdk.org/jdk/commit/4beb77192f54f27183285400d7cae7528df64e43&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14704567" author="aefimov" created="Thu, 12 Sep 2024 08:50:46 -0700"  >Discovered another timeout related isssue that needs to addressed:&lt;br/&gt;
DnsClient.Tcp uses milliseconds timesource to track the left timeout - it also needs to be updated to use nanos timesource.</comment>
                            <comment id="14704523" author="aefimov" created="Thu, 12 Sep 2024 06:16:41 -0700"  >It was discovered that there is another issue [1] in timeout handling by DnsClient:&lt;br/&gt;
&amp;quot;3. Observed timeout is much less than expected/calculated one by a significant amount. A failure example: Failed: timeout in 5786 ms, expected to be in a range (ms): 7505 - 13562. The possible reason: If there is an exception observed inside the retry loop (inside DnsClient.query method) the timeout left from the interrupted attempt is not carried over to the next one, therefore the difference can be as huge as a duration of one of retry attempts. Possible solution: implement the carry over of the left timeout of an interrupted attempt to the next one (or restart the interrupted retry attempt).&amp;quot;&lt;br/&gt;
&lt;br/&gt;
I was able to confirm it with a debug build that if exception happens in a middle of a retry attempt the left timeout is not compensated, and it causes the test failure:&lt;br/&gt;
&amp;quot;Left timeout after retry #0 = -12&lt;br/&gt;
doUdpQuery previousRequestInterrupted = false timeoutCarry = 0&lt;br/&gt;
SocketTimeoutException&lt;br/&gt;
Left timeout after retry #1 = -2&lt;br/&gt;
doUdpQuery previousRequestInterrupted = false timeoutCarry = 0&lt;br/&gt;
Left timeout after retry #2 = 998&lt;br/&gt;
doUdpQuery previousRequestInterrupted = true timeoutCarry = 998&lt;br/&gt;
&amp;quot;&lt;br/&gt;
&lt;br/&gt;
JavaTest Message: Test threw exception: java.lang.RuntimeException: Failed: timeout in 7017 ms, expected to be in a range (ms): 7750 - 15500&lt;br/&gt;
&lt;br/&gt;
The lost 998 ms is the reason of the failure.&lt;br/&gt;
&lt;br/&gt;
[1] &lt;a href=&quot;https://github.com/openjdk/jdk/pull/20892#discussion_r1754857360&quot;&gt;https://github.com/openjdk/jdk/pull/20892#discussion_r1754857360&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14703312" author="roboduke" created="Fri, 6 Sep 2024 09:36:22 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/20892&quot;&gt;https://git.openjdk.org/jdk/pull/20892&lt;/a&gt;&lt;br/&gt;
Date: 2024-09-06 16:28:36 +0000</comment>
                            <comment id="14702828" author="dfuchs" created="Wed, 4 Sep 2024 08:12:15 -0700"  >Actually there&amp;#39;s another bug here as reported in this thread &lt;a href=&quot;https://mail.openjdk.org/pipermail/core-libs-dev/2024-September/128792.html&quot;&gt;https://mail.openjdk.org/pipermail/core-libs-dev/2024-September/128792.html&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Line 474 should probably have been:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;timeoutLeft = timeoutLeft - ((int) (end - start));&lt;br/&gt;
&lt;br/&gt;
duke seems to be the one to blame...</comment>
                            <comment id="14702797" author="dfuchs" created="Wed, 4 Sep 2024 06:31:14 -0700"  >It would also be good to double check that no infinite loop can occur.&lt;br/&gt;
See &lt;a href=&quot;https://mail.openjdk.org/pipermail/core-libs-dev/2024-September/128792.html&quot;&gt;https://mail.openjdk.org/pipermail/core-libs-dev/2024-September/128792.html&lt;/a&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5152752">JDK-8351862</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5154797">JDK-8353646</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10600">
                    <name>Causes</name>
                                            <outwardlinks description="causes">
                                                        </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                                                <inwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5135827">JDK-8337720</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="4985005">JDK-8220213</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37sur:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17351"><![CDATA[b20]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="227"><![CDATA[javax.naming]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>