<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 10:14:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8315128] jdk/jfr/event/runtime/TestResidentSetSizeEvent.java fails with &quot;The size should be less than or equal to peak&quot;</title>
                <link>https://bugs.openjdk.org/browse/JDK-8315128</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The following test failed in the JDK22 CI:&lt;br/&gt;
&lt;br/&gt;
jdk/jfr/event/runtime/TestResidentSetSizeEvent.java&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s a snippet from the log file:&lt;br/&gt;
&lt;br/&gt;
#section:main&lt;br/&gt;
----------messages:(7/432)----------&lt;br/&gt;
command: main -Xms16m -Xmx128m -Xlog:gc jdk.jfr.event.runtime.TestResidentSetSizeEvent true&lt;br/&gt;
reason: User specified action: run main/othervm -Xms16m -Xmx128m -Xlog:gc jdk.jfr.event.runtime.TestResidentSetSizeEvent true &lt;br/&gt;
started: Mon Aug 28 14:18:39 GMT 2023&lt;br/&gt;
Mode: othervm [/othervm specified]&lt;br/&gt;
Additional options from @modules: --add-modules jdk.jfr,jdk.management&lt;br/&gt;
finished: Mon Aug 28 14:18:41 GMT 2023&lt;br/&gt;
elapsed time (seconds): 2.128&lt;br/&gt;
----------configuration:(3/50)----------&lt;br/&gt;
Boot Layer&lt;br/&gt;
&amp;nbsp;&amp;nbsp;add modules: jdk.jfr jdk.management&lt;br/&gt;
&lt;br/&gt;
----------System.out:(30/2293)----------&lt;br/&gt;
[0.011s][info][gc] Using G1&lt;br/&gt;
[0.774s][info][gc] GC(0) Pause Young (Normal) (G1 Evacuation Pause) 9M-&amp;gt;2M(18M) 4.672ms&lt;br/&gt;
[1.103s][info][gc] GC(1) Pause Young (Normal) (G1 Evacuation Pause) 8M-&amp;gt;3M(18M) 3.873ms&lt;br/&gt;
[1.284s][info][gc] GC(2) Pause Young (Normal) (G1 Evacuation Pause) 10M-&amp;gt;5M(18M) 1.756ms&lt;br/&gt;
[1.305s][info][gc] GC(3) Pause Young (Normal) (G1 Evacuation Pause) 10M-&amp;gt;10M(18M) 2.698ms&lt;br/&gt;
[1.318s][info][gc] GC(4) Pause Young (Concurrent Start) (G1 Evacuation Pause) 11M-&amp;gt;12M(18M) 1.016ms&lt;br/&gt;
[1.318s][info][gc] GC(5) Concurrent Mark Cycle&lt;br/&gt;
[1.326s][info][gc] GC(5) Pause Remark 12M-&amp;gt;12M(24M) 1.409ms&lt;br/&gt;
[1.328s][info][gc] GC(6) Pause Young (Normal) (G1 Evacuation Pause) 13M-&amp;gt;13M(24M) 1.308ms&lt;br/&gt;
[1.329s][info][gc] GC(5) Pause Cleanup 13M-&amp;gt;13M(24M) 0.056ms&lt;br/&gt;
[1.330s][info][gc] GC(5) Concurrent Mark Cycle 11.899ms&lt;br/&gt;
[1.333s][info][gc] GC(7) Pause Young (Prepare Mixed) (G1 Evacuation Pause) 15M-&amp;gt;15M(24M) 1.235ms&lt;br/&gt;
[1.335s][info][gc] GC(8) Pause Young (Mixed) (G1 Evacuation Pause) 16M-&amp;gt;16M(49M) 1.144ms&lt;br/&gt;
[1.349s][info][gc] GC(9) Pause Young (Normal) (G1 Evacuation Pause) 26M-&amp;gt;26M(49M) 4.119ms&lt;br/&gt;
[1.355s][info][gc] GC(10) Pause Young (Concurrent Start) (G1 Evacuation Pause) 32M-&amp;gt;33M(49M) 3.738ms&lt;br/&gt;
[1.355s][info][gc] GC(11) Concurrent Mark Cycle&lt;br/&gt;
[1.381s][info][gc] GC(12) Pause Young (Normal) (G1 Evacuation Pause) 37M-&amp;gt;38M(49M) 2.746ms&lt;br/&gt;
[1.383s][info][gc] GC(13) Pause Young (Normal) (G1 Evacuation Pause) 40M-&amp;gt;40M(81M) 1.430ms&lt;br/&gt;
[1.400s][info][gc] GC(11) Pause Remark 51M-&amp;gt;51M(87M) 3.852ms&lt;br/&gt;
[1.415s][info][gc] GC(14) Pause Young (Normal) (G1 Evacuation Pause) 51M-&amp;gt;52M(87M) 4.638ms&lt;br/&gt;
[1.428s][info][gc] GC(11) Pause Cleanup 54M-&amp;gt;54M(87M) 0.283ms&lt;br/&gt;
[1.429s][info][gc] GC(11) Concurrent Mark Cycle 74.393ms&lt;br/&gt;
[1.438s][info][gc] GC(15) Pause Young (Prepare Mixed) (G1 Evacuation Pause) 62M-&amp;gt;62M(87M) 5.704ms&lt;br/&gt;
[1.456s][info][gc] GC(16) Pause Young (Mixed) (G1 Evacuation Pause) 69M-&amp;gt;69M(87M) 4.723ms&lt;br/&gt;
[1.459s][info][gc] GC(17) Pause Young (Concurrent Start) (G1 Evacuation Pause) 73M-&amp;gt;74M(87M) 2.501ms&lt;br/&gt;
[1.459s][info][gc] GC(18) Concurrent Mark Cycle&lt;br/&gt;
[1.488s][info][gc] GC(18) Pause Remark 75M-&amp;gt;75M(127M) 1.388ms&lt;br/&gt;
[1.513s][info][gc] GC(18) Pause Cleanup 75M-&amp;gt;75M(127M) 0.102ms&lt;br/&gt;
[1.524s][info][gc] GC(18) Concurrent Mark Cycle 64.673ms&lt;br/&gt;
[1.660s][info][gc] GC(19) Pause Young (Prepare Mixed) (G1 Evacuation Pause) 77M-&amp;gt;75M(127M) 2.872ms&lt;br/&gt;
----------System.err:(14/1064)----------&lt;br/&gt;
java.lang.RuntimeException: The size should be less than or equal to peak: expected that 88915968 &amp;lt;= 88911872&lt;br/&gt;
	at jdk.test.lib.Asserts.fail(Asserts.java:594)&lt;br/&gt;
	at jdk.test.lib.Asserts.assertLessThanOrEqual(Asserts.java:154)&lt;br/&gt;
	at jdk.jfr.event.runtime.TestResidentSetSizeEvent.verifyExpectedEventTypes(TestResidentSetSizeEvent.java:83)&lt;br/&gt;
	at jdk.jfr.event.runtime.TestResidentSetSizeEvent.main(TestResidentSetSizeEvent.java:92)&lt;br/&gt;
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)&lt;br/&gt;
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)&lt;br/&gt;
	at com.sun.javatest.regtest.agent.MainWrapper$MainTask.run(MainWrapper.java:138)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:1570)&lt;br/&gt;
&lt;br/&gt;
JavaTest Message: Test threw exception: java.lang.RuntimeException: The size should be less than or equal to peak: expected that 88915968 &amp;lt;= 88911872&lt;br/&gt;
JavaTest Message: shutting down test&lt;br/&gt;
&lt;br/&gt;
STATUS:Failed.`main&amp;#39; threw exception: java.lang.RuntimeException: The size should be less than or equal to peak: expected that 88915968 &amp;lt;= 88911872&lt;br/&gt;
----------rerun:(40/7372)*----------</description>
                <environment></environment>
        <key id="5108991">JDK-8315128</key>
            <summary>jdk/jfr/event/runtime/TestResidentSetSizeEvent.java fails with &quot;The size should be less than or equal to peak&quot;</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="egahlin">Erik Gahlin</assignee>
                                    <reporter username="dcubed">Daniel Daugherty</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>tier8</label>
                    </labels>
                <created>Mon, 28 Aug 2023 09:44:56 -0700</created>
                <updated>Fri, 9 May 2025 19:47:40 -0700</updated>
                            <resolved>Mon, 4 Dec 2023 08:39:23 -0800</resolved>
                                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14776931" author="roboduke" created="Mon, 5 May 2025 12:18:43 -0700"  >[jdk21u-fix-request] Approval Request from Satyen Subramaniam&lt;br/&gt;
for backport. Fix adjusts the size threshold to avoid corner case resulting in failure.&lt;br/&gt;
&lt;br/&gt;
Risk: Low. Tip change was merged in December 2023 and is relatively trivial.&lt;br/&gt;
&lt;br/&gt;
Testing:&lt;br/&gt;
* GHA Sanity Checks&lt;br/&gt;
* Tier 1 and 2 tests locally</comment>
                            <comment id="14776916" author="roboduke" created="Mon, 5 May 2025 11:55:11 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1736&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1736&lt;/a&gt;&lt;br/&gt;
Date: 2025-05-05 18:50:03 +0000</comment>
                            <comment id="14631067" author="dukebot" created="Mon, 4 Dec 2023 08:39:22 -0800"  >Changeset: a9de5c7f&lt;br/&gt;
Author:    Erik Gahlin &amp;lt;&lt;a href=&apos;mailto:egahlin@openjdk.org&apos;&gt;egahlin@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-12-04 16:37:33 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/a9de5c7f130ceac5d82a413a40e10a8c594af529&quot;&gt;https://git.openjdk.org/jdk/commit/a9de5c7f130ceac5d82a413a40e10a8c594af529&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14630842" author="roboduke" created="Sun, 3 Dec 2023 12:13:51 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/16941&quot;&gt;https://git.openjdk.org/jdk/pull/16941&lt;/a&gt;&lt;br/&gt;
Date: 2023-12-03 19:40:45 +0000</comment>
                            <comment id="14629551" author="stefank" created="Tue, 28 Nov 2023 06:53:38 -0800"  >The problem seems to be in the MACH API in that they don&amp;#39;t synchronize the two values. An easy fix would probably be to change this to:&lt;br/&gt;
```&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;event.set_size(info.resident_size);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// We&amp;#39;ve seen that resident_size_max sometimes trails resident_size with one page.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// Make sure we always report size &amp;lt;= peak&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;event.set_peak(MAX2(info.resident_size_max, info.resident_size)); &lt;br/&gt;
```</comment>
                            <comment id="14629519" author="egahlin" created="Tue, 28 Nov 2023 05:49:43 -0800"  >How should we proceed with this failure? Make the test more resilient?</comment>
                            <comment id="14607316" author="stefank" created="Tue, 29 Aug 2023 04:43:04 -0700"  >It looks like the macOS API returns inconsistent values for resident_size and resident_size_max. The difference is one page: 88915968 - 88911872 == 4096&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;The code looks like this:&lt;br/&gt;
```&lt;br/&gt;
&amp;nbsp;&amp;nbsp;mach_task_basic_info info;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;mach_msg_type_number_t count = MACH_TASK_BASIC_INFO_COUNT;&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;kern_return_t ret = task_info(mach_task_self(), MACH_TASK_BASIC_INFO, (task_info_t)&amp;amp;info, &amp;amp;count);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (ret == KERN_SUCCESS) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// Send the RSS JFR event&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;EventResidentSetSize event;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;event.set_size(info.resident_size);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;event.set_peak(info.resident_size_max);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;event.commit();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
```&lt;br/&gt;
Either this is a bug in the kernel or there&amp;#39;s no guarantee that these two values are always in-sync. Maybe someone at Apple could check this out? </comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5158321">JDK-8356671</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19000"><![CDATA[x86_64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17017"><![CDATA[os_x]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32waz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17419"><![CDATA[b27]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="374"><![CDATA[jfr]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>