<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 10:18:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8321204] C2: assert(false) failed: node should be in igvn hash table</title>
                <link>https://bugs.openjdk.org/browse/JDK-8321204</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The following test failed in the JDK22 CI:&lt;br/&gt;
&lt;br/&gt;
serviceability/jvmti/vthread/premain/AgentWithVThreadTest.java&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s a snippet from the log file:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;2566  CastPP  === 277 75  [[ 332 ]]  #java/util/concurrent/ConcurrentHashMap (java/io/Serializable,java/util/Map,java/util/concurrent/ConcurrentMap) * extra types: {0:java/util/concurrent/ConcurrentHashMap (java/io/Serializable,java/util/Map,java/util/concurrent/ConcurrentMap):NotNull *} strong dependency  Oop:java/util/concurrent/ConcurrentHashMap (java/io/Serializable,java/util/Map,java/util/concurrent/ConcurrentMap) * !orig=[330] !jvms: ConcurrentHashMap::transfer @ bci:119 (line 2451)&lt;br/&gt;
&amp;nbsp;2567  CastPP  === 572 96  [[ 2528 ]]  #narrowoop: java/util/concurrent/ConcurrentHashMap$Node (java/util/Map$Entry) *[int:&amp;gt;=0] (java/lang/Cloneable,java/io/Serializable) * extra types: {0:narrowoop: java/util/concurrent/ConcurrentHashMap$Node (java/util/Map$Entry) *[int:&amp;gt;=0] (java/lang/Cloneable,java/io/Serializable):NotNull * (speculative=narrowoop: java/util/concurrent/ConcurrentHashMap$Node (java/util/Map$Entry) *[int:&amp;gt;=0] (java/lang/Cloneable,java/io/Serializable):NotNull:exact * (inline_depth=2))} strong dependency !orig=[2525] !jvms: ConcurrentHashMap::transfer @ bci:286 (line 2479)&lt;br/&gt;
&amp;nbsp;2568  CastPP  === 572 75  [[ 2528 ]]  #java/util/concurrent/ConcurrentHashMap (java/io/Serializable,java/util/Map,java/util/concurrent/ConcurrentMap) * extra types: {0:java/util/concurrent/ConcurrentHashMap (java/io/Serializable,java/util/Map,java/util/concurrent/ConcurrentMap):NotNull *} strong dependency  Oop:java/util/concurrent/ConcurrentHashMap (java/io/Serializable,java/util/Map,java/util/concurrent/ConcurrentMap) * !orig=[2524] !jvms: ConcurrentHashMap::transfer @ bci:286 (line 2479)&lt;br/&gt;
&amp;nbsp;2571  CastPP  === 572 122  [[ 2528 ]]  #narrowoop: java/util/concurrent/ConcurrentHashMap$Node (java/util/Map$Entry) *[int:&amp;gt;=0] (java/lang/Cloneable,java/io/Serializable) * extra types: {0:narrowoop: java/util/concurrent/ConcurrentHashMap$Node (java/util/Map$Entry) *[int:&amp;gt;=0] (java/lang/Cloneable,java/io/Serializable):NotNull * (speculative=narrowoop: java/util/concurrent/ConcurrentHashMap$Node (java/util/Map$Entry) *[int:&amp;gt;=0] (java/lang/Cloneable,java/io/Serializable):NotNull:exact * (inline_depth=2))} strong dependency !orig=[2184] !jvms: ConcurrentHashMap::transfer @ bci:835 (line 2556)&lt;br/&gt;
&lt;br/&gt;
erroneous node:&lt;br/&gt;
&amp;nbsp;1669  CheckCastPP  === 787 122  [[ 1680 1672 ]]  #narrowoop: java/util/concurrent/ConcurrentHashMap$Node (java/util/Map$Entry) *[int:&amp;gt;=0] (java/lang/Cloneable,java/io/Serializable) * (speculative=narrowoop: java/util/concurrent/ConcurrentHashMap$Node (java/util/Map$Entry) *[int:&amp;gt;=0] (java/lang/Cloneable,java/io/Serializable):NotNull:exact * (inline_depth=2)) !jvms: ConcurrentHashMap::setTabAt @ bci:16 (line 769) ConcurrentHashMap::transfer @ bci:524 (line 2513)&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (/opt/mach5/mesos/work_dir/slaves/0db9c48f-6638-40d0-9a4b-bd9cc7533eb8-S9727/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/1d6ddd57-1d54-42e6-9e30-de0cf9cd6984/runs/351ce9aa-3534-44ef-9871-1a02b65a033e/workspace/open/src/hotspot/share/opto/compile.cpp:4929), pid=554535, tid=554551&lt;br/&gt;
#  assert(false) failed: node should be in igvn hash table&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (22.0+27) (fastdebug build 22-ea+27-2156)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 22-ea+27-2156, mixed mode, tiered, compressed oops, compressed class ptrs, g1 gc, linux-aarch64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# V  [libjvm.so+0x8c6908]  Compile::remove_speculative_types(PhaseIterGVN&amp;amp;) [clone .part.0]+0x9c8&lt;br/&gt;
#&lt;br/&gt;
# Core dump will be written. Default location: Core dumps may be processed with &amp;quot;/opt/core.sh %p&amp;quot; (or dumping to /opt/mach5/mesos/work_dir/slaves/0db9c48f-6638-40d0-9a4b-bd9cc7533eb8-S10314/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/f2cdc390-4963-4503-ae56-73d3c828108d/runs/58798190-eb32-4a2e-b757-88d1782b5ddc/testoutput/test-support/jtreg_open_test_hotspot_jtreg_hotspot_loom/scratch/3/core.554535)&lt;br/&gt;
#&lt;br/&gt;
# An error report file with more information is saved as:&lt;br/&gt;
# /opt/mach5/mesos/work_dir/slaves/0db9c48f-6638-40d0-9a4b-bd9cc7533eb8-S10314/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/f2cdc390-4963-4503-ae56-73d3c828108d/runs/58798190-eb32-4a2e-b757-88d1782b5ddc/testoutput/test-support/jtreg_open_test_hotspot_jtreg_hotspot_loom/scratch/3/hs_err_pid554535.log&lt;br/&gt;
[thread 554558 also had an error]&lt;br/&gt;
&lt;br/&gt;
------ Timeout during error reporting after 120 s. ------&lt;br/&gt;
# [ timer expired, abort... ]&lt;br/&gt;
----------System.out:(1/53)----------&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s the crashing thread&amp;#39;s stack:&lt;br/&gt;
&lt;br/&gt;
---------------  T H R E A D  ---------------&lt;br/&gt;
&lt;br/&gt;
Current thread (0x0000ffff84304bf0):  JavaThread &amp;quot;C2 CompilerThread0&amp;quot; daemon [_thread_in_native, id=554551, stack(0x0000ffff55009000,0x0000ffff55207000) (2040K)]&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Current CompileTask:&lt;br/&gt;
C2:958  559 % !   4       java.util.concurrent.ConcurrentHashMap::transfer @ 96 (849 bytes)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x0000ffff55009000,0x0000ffff55207000],  sp=0x0000ffff55201e20,  free space=2019k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [libjvm.so+0x8c6908]  Compile::remove_speculative_types(PhaseIterGVN&amp;amp;) [clone .part.0]+0x9c8  (compile.cpp:4929)&lt;br/&gt;
V  [libjvm.so+0x8e04bc]  Compile::Optimize()+0x31c  (compile.cpp:4907)&lt;br/&gt;
V  [libjvm.so+0x8e36f0]  Compile::Compile(ciEnv*, ciMethod*, int, Options, DirectiveSet*)+0x14a0  (compile.cpp:857)&lt;br/&gt;
V  [libjvm.so+0x739860]  C2Compiler::compile_method(ciEnv*, ciMethod*, int, bool, DirectiveSet*)+0x17c  (c2compiler.cpp:134)&lt;br/&gt;
V  [libjvm.so+0x8eef74]  CompileBroker::invoke_compiler_on_method(CompileTask*)+0x7e0  (compileBroker.cpp:2299)&lt;br/&gt;
V  [libjvm.so+0x8efb5c]  CompileBroker::compiler_thread_loop()+0x598  (compileBroker.cpp:1958)&lt;br/&gt;
V  [libjvm.so+0xd6d8a8]  JavaThread::thread_main_inner()+0xe4  (javaThread.cpp:720)&lt;br/&gt;
V  [libjvm.so+0x159c910]  Thread::call_run()+0xac  (thread.cpp:220)&lt;br/&gt;
V  [libjvm.so+0x130f6ac]  thread_native_entry(Thread*)+0x12c  (os_linux.cpp:787)&lt;br/&gt;
C  [libpthread.so.0+0x7928]  start_thread+0x188</description>
                <environment></environment>
        <key id="5115964">JDK-8321204</key>
            <summary>C2: assert(false) failed: node should be in igvn hash table</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thartmann">Tobias Hartmann</assignee>
                                    <reporter username="dcubed">Daniel Daugherty</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>c2</label>
                            <label>intermittent-low-frequency</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>mach5-precious</label>
                            <label>noreg-hard</label>
                            <label>oracle-triage-22</label>
                            <label>tier5</label>
                    </labels>
                <created>Fri, 1 Dec 2023 14:18:37 -0800</created>
                <updated>Mon, 28 Apr 2025 09:50:49 -0700</updated>
                            <resolved>Mon, 20 May 2024 08:47:24 -0700</resolved>
                                    <version>11</version>
                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                    <version>23</version>
                                    <fixVersion>23</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14773621" author="roboduke" created="Thu, 24 Apr 2025 12:27:34 -0700"  >[jdk17u-fix-request] Approval Request from Satyen Subramaniam&lt;br/&gt;
for backport. Adjusts assert added by [&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8024070&quot; title=&quot;C2 needs some form of type speculation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8024070&quot;&gt;&lt;strike&gt;JDK-8024070&lt;/strike&gt;&lt;/a&gt;](&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8024070),&quot;&gt;https://bugs.openjdk.org/browse/JDK-8024070),&lt;/a&gt; and adds additional condition that Node::hash is non zero.&lt;br/&gt;
&lt;br/&gt;
Risk: Low-Medium Tip change was merged in April 2024, is essentially just adding an additional condition to an assert. Touches compilation logic. Only affects debug builds.&lt;br/&gt;
&lt;br/&gt;
Testing:&lt;br/&gt;
* GHA Sanity Checks&lt;br/&gt;
* Tier 1 and 2 tests locally</comment>
                            <comment id="14772688" author="roboduke" created="Tue, 22 Apr 2025 12:54:56 -0700"  >[jdk21u-fix-request] Approval Request from Satyen Subramaniam&lt;br/&gt;
for backport. Adjusts assert added by [&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8024070&quot; title=&quot;C2 needs some form of type speculation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8024070&quot;&gt;&lt;strike&gt;JDK-8024070&lt;/strike&gt;&lt;/a&gt;](&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8024070),&quot;&gt;https://bugs.openjdk.org/browse/JDK-8024070),&lt;/a&gt; reverts the additional printing added by [&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8312218&quot; title=&quot;Print additional debug information when hitting assert(in_hash)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8312218&quot;&gt;&lt;strike&gt;JDK-8312218&lt;/strike&gt;&lt;/a&gt;](&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8312218),&quot;&gt;https://bugs.openjdk.org/browse/JDK-8312218),&lt;/a&gt; and adds additional condition that Node::hash is non zero.&lt;br/&gt;
&lt;br/&gt;
Risk: Medium. Tip change was merged in April 2024, is essentially just adding an additional condition to an assert. Touches compilation logic.&lt;br/&gt;
&lt;br/&gt;
Testing:&lt;br/&gt;
* GHA Sanity Checks&lt;br/&gt;
* Tier 1 and 2 tests locally</comment>
                            <comment id="14772674" author="roboduke" created="Tue, 22 Apr 2025 12:16:53 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/3520&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/3520&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-22 19:10:18 +0000</comment>
                            <comment id="14772673" author="roboduke" created="Tue, 22 Apr 2025 12:16:12 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1695&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1695&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-22 19:07:51 +0000</comment>
                            <comment id="14679712" author="roboduke" created="Fri, 7 Jun 2024 01:36:43 -0700"  >[jdk22u-fix-request] Approval Request from Martin&lt;br/&gt;
The assertion has been hit several times in JDK 22. This backport fixes the assertion. It is very small, applies cleanly and tier 1-4 has passed. It only has an effect on debug builds.</comment>
                            <comment id="14679443" author="roboduke" created="Thu, 6 Jun 2024 03:08:30 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk22u/pull/245&quot;&gt;https://git.openjdk.org/jdk22u/pull/245&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-06 10:02:56 +0000</comment>
                            <comment id="14663507" author="dukebot" created="Mon, 8 Apr 2024 00:32:06 -0700"  >Changeset: d1aad712&lt;br/&gt;
Author:    Tobias Hartmann &amp;lt;&lt;a href=&apos;mailto:thartmann@openjdk.org&apos;&gt;thartmann@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-04-08 07:30:31 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/d1aad71209092013a89b3b85a258dd4d2e31224a&quot;&gt;https://git.openjdk.org/jdk/commit/d1aad71209092013a89b3b85a258dd4d2e31224a&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14663103" author="roboduke" created="Fri, 5 Apr 2024 00:50:46 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/18647&quot;&gt;https://git.openjdk.org/jdk/pull/18647&lt;/a&gt;&lt;br/&gt;
Date: 2024-04-05 07:45:20 +0000</comment>
                            <comment id="14662910" author="chagedorn" created="Thu, 4 Apr 2024 08:13:50 -0700"  >Nice catch! That could indeed explain the quite rare and non-reproducible cases we&amp;#39;ve observed in recent months and years.</comment>
                            <comment id="14662896" author="thartmann" created="Thu, 4 Apr 2024 07:13:26 -0700"  >After eyeballing the logs and the code for a while, I suspect that this is an extremely rare case where Node::hash is 0 which is equivalent to Node::NO_HASH and we therefore return false from NodeHash::hash_delete. &lt;br/&gt;
&lt;br/&gt;
Hardcoding the hash value to 0 will immediately trigger this:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;uint ConstraintCastNode::hash() const {&lt;br/&gt;
-  return TypeNode::hash() + (int)_dependency + (_extra_types != nullptr ? _extra_types-&amp;gt;hash() : 0);&lt;br/&gt;
+  return 0;&lt;br/&gt;
&amp;nbsp;}&lt;br/&gt;
</comment>
                            <comment id="14647891" author="thartmann" created="Fri, 9 Feb 2024 01:59:27 -0800"  >I checked the newest failures but the replay files are either not available or don&amp;#39;t reproduce the issue.&lt;br/&gt;
&lt;br/&gt;
Update: And with another one from 2024-02-06. No luck.</comment>
                            <comment id="14638467" author="thartmann" created="Tue, 9 Jan 2024 00:50:20 -0800"  >I tried the replay file from the latest failure but it does not reproduce the issue.</comment>
                            <comment id="14630946" author="chagedorn" created="Mon, 4 Dec 2023 02:12:44 -0800"  >Most likely similar to &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8312134&quot; title=&quot;assert(in_hash) failed: node should be in igvn hash table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8312134&quot;&gt;&lt;strike&gt;JDK-8312134&lt;/strike&gt;&lt;/a&gt; but now we have more debugging information in the log (since &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8312218&quot; title=&quot;Print additional debug information when hitting assert(in_hash)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8312218&quot;&gt;&lt;strike&gt;JDK-8312218&lt;/strike&gt;&lt;/a&gt;).&lt;br/&gt;
&lt;br/&gt;
ILW = Same as &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8312134&quot; title=&quot;assert(in_hash) failed: node should be in igvn hash table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8312134&quot;&gt;&lt;strike&gt;JDK-8312134&lt;/strike&gt;&lt;/a&gt; = P4</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5156948">JDK-8355551</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5157208">JDK-8355757</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5105562">JDK-8312134</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5126311">JDK-8329777</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="4692255">JDK-8024070</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i342wr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17354"><![CDATA[b18]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>