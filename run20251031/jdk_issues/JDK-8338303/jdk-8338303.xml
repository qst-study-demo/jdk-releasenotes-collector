<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 09:47:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8338303] Linux ppc64le with toolchain clang - detection failure in early JVM startup</title>
                <link>https://bugs.openjdk.org/browse/JDK-8338303</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>When building on Linux ppc64le with the clang toolchain,  the new JVM fails already in the build process with this error :&lt;br/&gt;
&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  SIGILL (0x4) at pc=0x000079198fae03ac, pid=2922849, tid=2923410&lt;br/&gt;
#&lt;br/&gt;
# JRE version:  (24.0.0.1) (build )&lt;br/&gt;
# Java VM: OpenJDK 64-Bit Server VM (24.0.0.1-internal-adhoc.d040975.jdk, mixed mode, tiered, compressed oops, compressed class ptrs, g1 gc, linux-ppc64le)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# v  ~BufferBlob::detect_cpu_features 0x000079198fae03ac&lt;br/&gt;
#&lt;br/&gt;
&lt;br/&gt;
Host: POWER9 (architected), altivec supported, 64 cores, 127G, Ubuntu 22.04.4 LTS&lt;br/&gt;
Time: Tue Aug 13 08:01:50 2024 UTC elapsed time: 0.023703 seconds (0d 0h 0m 0s)&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
---------------  T H R E A D  ---------------&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
Current thread (0x000079199802c800):  JavaThread &amp;quot;Unknown thread&amp;quot; [_thread_in_vm, id=2923410, stack(0x000079199c990000,0x000079199cb90000) (2048K)]&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
Stack: [0x000079199c990000,0x000079199cb90000],  sp=0x000079199cb8b7c0,  free space=2029k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
v  ~BufferBlob::detect_cpu_features 0x000079198fae03ac&lt;br/&gt;
V  [libjvm.so+0x1206cb8]  (vm_version_ppc.cpp:60)&lt;br/&gt;
V  [libjvm.so+0x1206a98]  (vm_version.cpp:32)&lt;br/&gt;
V  [libjvm.so+0xa6e234]  (init.cpp:128)&lt;br/&gt;
V  [libjvm.so+0x11600a0]  (threads.cpp:550)&lt;br/&gt;
V  [libjvm.so+0xbaa0ac]  JNI_CreateJavaVM+0xac  (jni.cpp:3581)&lt;br/&gt;
C  [libjli.so+0x185bc]  (java.c:1592)&lt;br/&gt;
C  [libjli.so+0x1c158]  (java_md.c:653)&lt;br/&gt;
C  [libc.so.6+0xb5804]&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
siginfo: si_signo: 4 (SIGILL), si_code: 1 (ILL_ILLOPC), si_addr: 0x000079198fae03ac&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5136705">JDK-8338303</key>
            <summary>Linux ppc64le with toolchain clang - detection failure in early JVM startup</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mbaesken">Matthias Baesken</assignee>
                                    <reporter username="mbaesken">Matthias Baesken</reporter>
                        <labels>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jdk24u-fix-SQE-ok-next</label>
                            <label>jdk24u-fix-request</label>
                            <label>jdk24u-fix-yes</label>
                            <label>oraclejdk-na</label>
                    </labels>
                <created>Tue, 13 Aug 2024 05:48:26 -0700</created>
                <updated>Mon, 17 Feb 2025 03:44:36 -0800</updated>
                            <resolved>Sun, 26 Jan 2025 23:41:06 -0800</resolved>
                                    <version>21</version>
                    <version>24</version>
                                    <fixVersion>25</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14751772" author="mbaesken" created="Thu, 13 Feb 2025 07:25:28 -0800"  >jdk21u-dev backport request&lt;br/&gt;
I would like to have the patch in jdk21u-dev as well, because the issue is present there too. The backport is low risk and clean.</comment>
                            <comment id="14751399" author="mbaesken" created="Wed, 12 Feb 2025 05:59:10 -0800"  >jdk24u backport request&lt;br/&gt;
I would like to have the patch in jdk24u as well, because the issue is present there too. The backport is low risk and clean.</comment>
                            <comment id="14751397" author="roboduke" created="Wed, 12 Feb 2025 05:55:23 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1402&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1402&lt;/a&gt;&lt;br/&gt;
Date: 2025-02-12 13:49:06 +0000</comment>
                            <comment id="14751390" author="roboduke" created="Wed, 12 Feb 2025 05:41:57 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk24u/pull/72&quot;&gt;https://git.openjdk.org/jdk24u/pull/72&lt;/a&gt;&lt;br/&gt;
Date: 2025-02-12 13:38:02 +0000</comment>
                            <comment id="14744119" author="dukebot" created="Sun, 26 Jan 2025 23:41:05 -0800"  >Changeset: 70eec900&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Matthias Baesken &amp;lt;&lt;a href=&apos;mailto:mbaesken@openjdk.org&apos;&gt;mbaesken@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2025-01-27 07:35:40 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/70eec9001a550888f35476f9e2cf3c62d41442dd&quot;&gt;https://git.openjdk.org/jdk/commit/70eec9001a550888f35476f9e2cf3c62d41442dd&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14742983" author="roboduke" created="Fri, 24 Jan 2025 01:14:20 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/23292&quot;&gt;https://git.openjdk.org/jdk/pull/23292&lt;/a&gt;&lt;br/&gt;
Date: 2025-01-24 09:09:15 +0000</comment>
                            <comment id="14742660" author="mbaesken" created="Thu, 23 Jan 2025 08:20:43 -0800"  >Seems we missed the important compile flag  -DABI_ELFv2   when building with clang  on Linuxppc64le .  With this flag added (see patch below) the build works ! &lt;br/&gt;
&lt;br/&gt;
diff --git a/make/autoconf/flags-cflags.m4 b/make/autoconf/flags-cflags.m4&lt;br/&gt;
index 729e508cc26..8a861641601 100644&lt;br/&gt;
--- a/make/autoconf/flags-cflags.m4&lt;br/&gt;
+++ b/make/autoconf/flags-cflags.m4&lt;br/&gt;
@@ -736,6 +736,11 @@ AC_DEFUN([FLAGS_SETUP_CFLAGS_CPU_DEP],&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;# for all archs except arm and ppc, prevent gcc to omit frame pointer&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$1_CFLAGS_CPU_JDK=&amp;quot;${$1_CFLAGS_CPU_JDK} -fno-omit-frame-pointer&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;fi&lt;br/&gt;
+      if test &amp;quot;x$FLAGS_CPU&amp;quot; = xppc64le; then&lt;br/&gt;
+        # Little endian machine uses ELFv2 ABI.&lt;br/&gt;
+        # Use Power8, this is the first CPU to support PPC64 LE with ELFv2 ABI.&lt;br/&gt;
+        $1_CFLAGS_CPU_JVM=&amp;quot;${$1_CFLAGS_CPU_JVM} -DABI_ELFv2 -mcpu=power8 -mtune=power8&amp;quot;&lt;br/&gt;
+      fi&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;fi&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if test &amp;quot;x$OPENJDK_TARGET_OS&amp;quot; = xaix; then&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;$1_CFLAGS_CPU=&amp;quot;-mcpu=pwr8&amp;quot;&lt;br/&gt;
</comment>
                            <comment id="14742636" author="mbaesken" created="Thu, 23 Jan 2025 06:35:11 -0800"  >&amp;gt; Clang supports -stdlib=libc++ and -stdlib=libstdc++.&lt;br/&gt;
&lt;br/&gt;
I see no stdlib setting in the build log so I think it is the default one  (libc++ ?) .  But I do not see those in the list of dynamic libs of the hserr .&lt;br/&gt;
&lt;br/&gt;
Signal handlers look like this in the hserr :&lt;br/&gt;
&lt;br/&gt;
Signal Handlers:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGSEGV: 0x0000754fb8b90840 in libjvm.so+19335232, mask=11100100010111111101111111111110, flags=SA_RESTART|SA_SIGINFO, unblocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGBUS: 0x0000754fb8b90840 in libjvm.so+19335232, mask=11100100010111111101111111111110, flags=SA_RESTART|SA_SIGINFO, unblocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGFPE: 0x0000754fb8b90840 in libjvm.so+19335232, mask=11100100010111111101111111111110, flags=SA_RESTART|SA_SIGINFO, unblocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGPIPE: 0x0000754fb8a17c10 in libjvm.so+17792016, mask=11100100010111111101111111111110, flags=SA_RESTART|SA_SIGINFO, blocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGXFSZ: 0x0000754fb8a17c10 in libjvm.so+17792016, mask=11100100010111111101111111111110, flags=SA_RESTART|SA_SIGINFO, blocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGILL: 0x0000754fb8b90840 in libjvm.so+19335232, mask=11100100010111111101111111111110, flags=SA_RESTART|SA_SIGINFO, unblocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGUSR2: 0x0000754fb8a176e0 in libjvm.so+17790688, mask=00000000000000000000000000000000, flags=SA_RESTART|SA_SIGINFO, blocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGHUP: SIG_DFL, mask=00000000000000000000000000000000, flags=none, blocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGINT: SIG_DFL, mask=00000000000000000000000000000000, flags=none, blocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGTERM: SIG_DFL, mask=00000000000000000000000000000000, flags=none, blocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGQUIT: 0x0000754fb8a15330 in libjvm.so+17781552, mask=11100100010111111101111111111110, flags=SA_RESTART|SA_SIGINFO, blocked&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;SIGTRAP: 0x0000754fb8b90840 in libjvm.so+19335232, mask=11100100010111111101111111111110, flags=SA_RESTART|SA_SIGINFO, unblocked&lt;br/&gt;
&lt;br/&gt;
Regarding code cache we have to check.</comment>
                            <comment id="14742625" author="mdoerr" created="Thu, 23 Jan 2025 05:50:53 -0800"  >That&amp;#39;s the first thing from the code cache which is supposed to get executed. Is the code cache executable? Is the hotspot signal handler properly registered?&lt;br/&gt;
Which C++ library is used? Clang supports -stdlib=libc++ and -stdlib=libstdc++.</comment>
                            <comment id="14735703" author="mbaesken" created="Fri, 3 Jan 2025 07:07:02 -0800"  >The problem was observed e.g. with  &amp;quot;Ubuntu clang version 18.1.3 (1ubuntu1)&amp;quot;   on Ubuntu 24.04 ;  but I think I saw it also with  older clang versions on Linux ppc64le.</comment>
                            <comment id="14726949" author="mbaesken" created="Thu, 28 Nov 2024 03:03:51 -0800"  >Same issue can be seen on Power10 too, already in the build of a new OpenJDK :&lt;br/&gt;
&lt;br/&gt;
Host: POWER10 (architected), altivec supported, 64 cores, 127G, Ubuntu 24.04.1 LTS&lt;br/&gt;
Time: Thu Nov 28 09:51:46 2024 CET elapsed time: 0.010915 seconds (0d 0h 0m 0s)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x000070d559200000,0x000070d559400000],  sp=0x000070d5593f9920,  free space=2022k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
v  ~BufferBlob::detect_cpu_features 0x000070d54c3c03a8&lt;br/&gt;
V  [libjvm.so+0x11f8cd8]  (vm_version_ppc.cpp:60)&lt;br/&gt;
V  [libjvm.so+0x11f8ac8]  (vm_version.cpp:32)&lt;br/&gt;
V  [libjvm.so+0xa51ed4]  (init.cpp:128)&lt;br/&gt;
V  [libjvm.so+0x1151174]  (threads.cpp:574)&lt;br/&gt;
V  [libjvm.so+0xb8ec6c]  JNI_CreateJavaVM+0xac  (jni.cpp:3590)&lt;br/&gt;
C  [libjli.so+0x17ecc]  (java.c:1488)&lt;br/&gt;
C  [libjli.so+0x1ba78]  (java_md.c:633)&lt;br/&gt;
C  [libc.so.6+0xb2a5c]&lt;br/&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5150635">JDK-8350012</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5150831">JDK-8350191</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5144355">JDK-8344607</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17024"><![CDATA[ppc]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37jjv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17337"><![CDATA[b08]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>