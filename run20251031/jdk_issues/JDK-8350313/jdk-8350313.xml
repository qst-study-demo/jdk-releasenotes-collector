<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 10:55:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8350313] Include timings for leaving safepoint in safepoint logging</title>
                <link>https://bugs.openjdk.org/browse/JDK-8350313</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>We have a production use case where leaving the safepoint introduced a significant latency, mostly due to VMThread getting de-scheduled. There are mitigations for this, see &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8350324&quot; title=&quot;Prioritize VMThread for safepoint operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8350324&quot;&gt;JDK-8350324&lt;/a&gt;. This issue is about capturing such an event in safepoint logging more comprehensively.&lt;br/&gt;
&lt;br/&gt;
In those cases we would see something like:&lt;br/&gt;
&lt;br/&gt;
[3.664s][info][gc       ] GC(7) Pause Young (Allocation Failure) 277M-&amp;gt;3M(989M) 5.145ms&lt;br/&gt;
[3.694s][info][safepoint] Safepoint &amp;quot;SerialCollectForAllocation&amp;quot;, Time since last: 374870126 ns, Reaching safepoint: 271019 ns, At safepoint: 35859436 ns, Total: 36130455 ns&lt;br/&gt;
&lt;br/&gt;
...which is extremely confusing: the GC itself took ~5ms, yet &amp;quot;At safepoint&amp;quot; mentions 35ms! All that time is actually spent disarming the WaitBarrier, and eating the de/re-scheduling for VMThread at the same time.&lt;br/&gt;
&lt;br/&gt;
I think a &amp;quot;Leaving safepoint&amp;quot; counter would be good to have. It comes with the symmetry advantage with &amp;quot;Reaching safepoint&amp;quot; counter. &amp;quot;Leaving safepoint&amp;quot; measures the time spent in safepoint machinery from the &amp;quot;finishing side&amp;quot;. And, it more clearly captures the transitional state where some threads might be still at safepoint, and some have already unparked, like &amp;quot;Reaching safepoint&amp;quot;.&lt;br/&gt;
&lt;br/&gt;
So the hypothetical log for the excerpt above would look something like:&lt;br/&gt;
&lt;br/&gt;
[3.664s][info][gc       ] GC(7) Pause Young (Allocation Failure) 277M-&amp;gt;3M(989M) 5.145ms&lt;br/&gt;
[3.694s][info][safepoint] Safepoint &amp;quot;SerialCollectForAllocation&amp;quot;, Time since last: 374870126 ns, Reaching safepoint: 271019 ns, At safepoint: 5859436 ns, Leaving safepoint: 30000000 ns, Total: 36130455 ns</description>
                <environment></environment>
        <key id="5150968">JDK-8350313</key>
            <summary>Include timings for leaving safepoint in safepoint logging</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xpeng">Xiaolong Peng</assignee>
                                    <reporter username="shade">Aleksey Shipilev</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jdk24u-fix-SQE-ok-next</label>
                            <label>jdk24u-fix-request</label>
                            <label>jdk24u-fix-yes</label>
                            <label>safepoint</label>
                    </labels>
                <created>Wed, 19 Feb 2025 00:44:12 -0800</created>
                <updated>Tue, 22 Apr 2025 07:44:54 -0700</updated>
                            <resolved>Wed, 26 Feb 2025 09:32:42 -0800</resolved>
                                    <version>17</version>
                    <version>21</version>
                    <version>25</version>
                                    <fixVersion>25</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14772349" author="roboduke" created="Mon, 21 Apr 2025 17:05:53 -0700"  >[jdk21u-fix-request] Approval Request from Xiaolong Peng&lt;br/&gt;
Backport to JDK21 to include timings to leave safepoint in safepoint logs to give us visibility into how long it takes to leave safepoint. It is not a clean backport due to cleanup timings which have been removed in newer version. Tested and verified the new safepoint logs, also run Tier 1 and Tier 2 test, overall risk is very low.</comment>
                            <comment id="14771922" author="roboduke" created="Sun, 20 Apr 2025 18:59:17 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1683&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1683&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-20 08:12:01 +0000</comment>
                            <comment id="14769903" author="roboduke" created="Mon, 14 Apr 2025 12:03:24 -0700"  >[jdk24u-fix-request] Approval Request from Xiaolong Peng&lt;br/&gt;
Backport to JDK24 to include timings to leave safepoint in safepoint logs, cleanly applied. I have run teir2 test and verified the safepoint log. GHA for MacOS failed for unrelated reason - Unable to download artifact(s): Artifact not found for name: bundles-jtreg-7.4+1.</comment>
                            <comment id="14768753" author="roboduke" created="Wed, 9 Apr 2025 15:37:23 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk24u/pull/186&quot;&gt;https://git.openjdk.org/jdk24u/pull/186&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-09 21:14:37 +0000</comment>
                            <comment id="14756558" author="dukebot" created="Wed, 26 Feb 2025 09:32:41 -0800"  >Changeset: 9ec46968&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Xiaolong Peng &amp;lt;&lt;a href=&apos;mailto:xpeng@openjdk.org&apos;&gt;xpeng@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Aleksey Shipilev &amp;lt;&lt;a href=&apos;mailto:shade@openjdk.org&apos;&gt;shade@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2025-02-26 17:29:12 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/9ec46968fbfddf99a8349cb6903d24b1c2fdaf1d&quot;&gt;https://git.openjdk.org/jdk/commit/9ec46968fbfddf99a8349cb6903d24b1c2fdaf1d&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14755928" author="roboduke" created="Mon, 24 Feb 2025 15:53:21 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/23756&quot;&gt;https://git.openjdk.org/jdk/pull/23756&lt;/a&gt;&lt;br/&gt;
Date: 2025-02-24 20:48:25 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5156419">JDK-8355058</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5156695">JDK-8355316</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5150979">JDK-8350324</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39wcz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17349"><![CDATA[b12]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>