<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 10:03:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8346880] [aix] java/lang/ProcessHandle/InfoTest.java still fails: &quot;reported cputime less than expected&quot;</title>
                <link>https://bugs.openjdk.org/browse/JDK-8346880</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The test java/lang/ProcessHandle/InfoTest.java still fails sporadically on AIX. The test exclusion was removed through &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8211847&quot; title=&quot;[aix] java/lang/ProcessHandle/InfoTest.java fails: &amp;quot;reported cputime less than expected&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8211847&quot;&gt;&lt;strike&gt;JDK-8211847&lt;/strike&gt;&lt;/a&gt; under the assumption the problem was gone. But it turned out that it was wrong.&lt;br/&gt;
&lt;br/&gt;
We can see an exception like:&lt;br/&gt;
&lt;br/&gt;
java.lang.AssertionError: reported cputime less than expected: PT0.2S, actual: Optional[PT0.021179882S]&lt;br/&gt;
	at org.testng.Assert.fail(Assert.java:99)&lt;br/&gt;
	at InfoTest.test1(InfoTest.java:110)&lt;br/&gt;
&lt;br/&gt;
After a discussion with Roger Riggs and the team, we came to the following conclusion.&lt;br/&gt;
The problem is based on 2 independent causes; one fundamental and one AIX-specific.&lt;br/&gt;
&lt;br/&gt;
The fundamental cause is as follows:&lt;br/&gt;
Modern hardware provides many hardware threads (up to several hundred) that enable the worker threads of the processes to be processed in real parallel. To ensure that such a worker thread does not take up a hardware thread resource for itself, it is rolled out by the OS after a few ms at the latest to make room for another worker thread, possibly from another process.&lt;br/&gt;
The OS continuously adds up all the times that each worker thread of a process is active as process cpu time.&lt;br/&gt;
&lt;br/&gt;
It is easy to see that there is no correlation between the CPU time of a process and the real time(wall time).&lt;br/&gt;
&lt;br/&gt;
If you have a system with many hardware threads and few worker threads, these are active almost all the time. If they are rolled out, they are immediately rolled back in due to a lack of competition. If a process has several worker threads, the CPU time will increase faster than the real time. In this case, cpu time &amp;gt; real time is to be expected, which is what the test wants.&lt;br/&gt;
&lt;br/&gt;
However, if the same system is heavily loaded, i.e. there are a lot of worker threads competing on one hardware thread, each individual worker thread can only become active relatively rarely. Even if a process has several worker threads, the total CPU time will be less than the past real time. This is even more pronounced if the individual worker threads have to wait for each other via synchronization objects. Since this is the normal case, cpu time &amp;lt; real time usually applies.&lt;br/&gt;
&lt;br/&gt;
Therefore, such a test makes little sense in principle.&lt;br/&gt;
&lt;br/&gt;
The AIX-specific cause of the problem lies in the API used to get the cpu time. The /proc/&amp;lt;pid&amp;gt;/psinfo file is evaluated to obtain the cpu time. The /proc directory is only present on AIX for portability reasons. The data in it is only updated at long intervals. For example, the cpu time is only updated every 1-2 seconds, which can cause the error.&lt;br/&gt;
The better solution here would be the getprocs64() API. Here the values &#8203;&#8203;for the cpu time are updated by the OS kernel every few ms.&lt;br/&gt;
&lt;br/&gt;
It may therefore be that the error no longer occurs after adjusting the AIX coding, but in principle the problem is not solved.&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5147069">JDK-8346880</key>
            <summary>[aix] java/lang/ProcessHandle/InfoTest.java still fails: &quot;reported cputime less than expected&quot;</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jkern">Joachim Kern</assignee>
                                    <reporter username="clanger">Christoph Langer</reporter>
                        <labels>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jdk24u-fix-SQE-ok-next</label>
                            <label>jdk24u-fix-request</label>
                            <label>jdk24u-fix-yes</label>
                    </labels>
                <created>Mon, 30 Dec 2024 05:12:50 -0800</created>
                <updated>Mon, 17 Feb 2025 01:54:28 -0800</updated>
                            <resolved>Thu, 9 Jan 2025 06:26:18 -0800</resolved>
                                    <version>21</version>
                    <version>23</version>
                    <version>24</version>
                    <version>25</version>
                                    <fixVersion>25</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14753731" author="roboduke" created="Fri, 14 Feb 2025 03:45:48 -0800"  >[jdk21u-fix-request] Approval Request from JoKern65&lt;br/&gt;
I would like to have the patch in jdk21u-dev, because the issue is present there too. The backport is clean and low risk.</comment>
                            <comment id="14753712" author="roboduke" created="Fri, 14 Feb 2025 02:01:45 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1404&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1404&lt;/a&gt;&lt;br/&gt;
Date: 2025-02-14 09:55:46 +0000</comment>
                            <comment id="14751768" author="roboduke" created="Thu, 13 Feb 2025 07:16:32 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk24u/pull/75&quot;&gt;https://git.openjdk.org/jdk24u/pull/75&lt;/a&gt;&lt;br/&gt;
Date: 2025-02-13 15:12:02 +0000</comment>
                            <comment id="14751767" author="mbaesken" created="Thu, 13 Feb 2025 07:13:27 -0800"  >jdk24u backport request&lt;br/&gt;
I would like to have the patch in jdk24u, because the issue is present there too.  The backport is clean and low risk.</comment>
                            <comment id="14737007" author="dukebot" created="Thu, 9 Jan 2025 06:26:17 -0800"  >Changeset: f9b11332&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Joachim Kern &amp;lt;&lt;a href=&apos;mailto:jkern@openjdk.org&apos;&gt;jkern@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2025-01-09 14:24:12 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/f9b11332eccd8a8ffb4128308f442b209d07a3b1&quot;&gt;https://git.openjdk.org/jdk/commit/f9b11332eccd8a8ffb4128308f442b209d07a3b1&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14736649" author="roboduke" created="Wed, 8 Jan 2025 03:58:41 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/22966&quot;&gt;https://git.openjdk.org/jdk/pull/22966&lt;/a&gt;&lt;br/&gt;
Date: 2025-01-08 11:53:43 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5150697">JDK-8350071</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5150822">JDK-8350183</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="4973552">JDK-8211847</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5147521">JDK-8347270</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="18900"><![CDATA[aix]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i398bf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17334"><![CDATA[b06]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="190"><![CDATA[java.lang]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>