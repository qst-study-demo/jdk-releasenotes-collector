<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 10:24:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8330936] [ubsan] exclude function BilinearInterp and ShapeSINextSpan in libawt java2d from ubsan checks</title>
                <link>https://bugs.openjdk.org/browse/JDK-8330936</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>When running the  :tier4 of the jdk  jtreg  test  (java/awt,  javax/swing,  sun/java2d )  with binaries  compiled with -ftrapv&lt;br/&gt;
to catch signed integer overflows, we get reproducibly those signed int overflow  errors (similar to &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8330615&quot; title=&quot;avoid signed integer overflows in zip_util.c readCen / hashN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8330615&quot;&gt;&lt;strike&gt;JDK-8330615&lt;/strike&gt;&lt;/a&gt;) .&lt;br/&gt;
&lt;br/&gt;
java/awt/Paint/PgramUserBoundsTest.java&lt;br/&gt;
&lt;br/&gt;
#  SIGILL (0x4) at pc=0x000000010930a686, pid=3989, tid=43267&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# C  [libawt.dylib+0x51686]  ShapeSINextSpan+0x616&lt;br/&gt;
&lt;br/&gt;
&amp;gt; C  [libawt.so+0xd3e58]  ShapeSINextSpan+0x568  (ShapeSpanIterator.c:1366)&lt;br/&gt;
&amp;gt; C  [libawt.so+0xd38b0]  Java_sun_java2d_pipe_ShapeSpanIterator_nextSpan+0x50  (ShapeSpanIterator.c:509)&lt;br/&gt;
&amp;gt; j  sun.java2d.pipe.ShapeSpanIterator.nextSpan([I)Z+0 &lt;a href=&apos;mailto:java.desktop@23.0.0.1-internal&apos;&gt;java.desktop@23.0.0.1-internal&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
and&lt;br/&gt;
&lt;br/&gt;
java/awt/Scrollbar/AquaLFScrollbarTest/ScrollBarBorderTest.java&lt;br/&gt;
&lt;br/&gt;
#  SIGILL (0x4) at pc=0x000000010c98243d, pid=4021, tid=40963&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# C  [libawt.dylib+0x5843d]  BilinearInterp+0x17d&lt;br/&gt;
&lt;br/&gt;
&amp;gt; C  [libawt.so+0xe3e97]  BilinearInterp+0x787  (TransformHelper.c:683)&lt;br/&gt;
&amp;gt; C  [libawt.so+0xe6f84]  Java_sun_java2d_loops_TransformHelper_Transform+0xe64  (TransformHelper.c:499)&lt;br/&gt;
&amp;gt; j  sun.java2d.loops.TransformHelper.Transform(Lsun/java2d/loops/MaskBlit;Lsun/java2d/SurfaceData;Lsun/java2d/SurfaceData;Ljava/awt/Composite;Lsun/java2d/pipe/Region;Ljava/awt/geom/AffineTransform;IIIIIIIII[III)V+0 &lt;a href=&apos;mailto:java.desktop@23.0.0.1-internal&apos;&gt;java.desktop@23.0.0.1-internal&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Seems there is no change to this coding intended in the short term  so I suggest to exclude the 2 functions from ubsan-checking .&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5127688">JDK-8330936</key>
            <summary>[ubsan] exclude function BilinearInterp and ShapeSINextSpan in libawt java2d from ubsan checks</summary>
                <type id="5" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14716&amp;avatarType=issuetype">Sub-task</type>
                            <parent id="5149456">JDK-8348966</parent>
                                    <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mbaesken">Matthias Baesken</assignee>
                                    <reporter username="mbaesken">Matthias Baesken</reporter>
                        <labels>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jdk24u-fix-SQE-ok</label>
                            <label>jdk24u-fix-request</label>
                            <label>jdk24u-fix-yes</label>
                            <label>sn_171</label>
                            <label>ubsan</label>
                    </labels>
                <created>Tue, 23 Apr 2024 01:09:50 -0700</created>
                <updated>Mon, 7 Apr 2025 06:19:09 -0700</updated>
                            <resolved>Thu, 6 Mar 2025 00:12:41 -0800</resolved>
                                    <version>8</version>
                    <version>11</version>
                    <version>17</version>
                    <version>21</version>
                    <version>25</version>
                                    <fixVersion>25</fixVersion>
                                    <component>client-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14767123" author="roboduke" created="Fri, 4 Apr 2025 05:14:40 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1591&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1591&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-04 12:06:08 +0000</comment>
                            <comment id="14767122" author="mbaesken" created="Fri, 4 Apr 2025 05:14:24 -0700"  >jdk21u-dev backport request&lt;br/&gt;
I would like to have the patch in jdk21u-dev as well, because it would be helpful there too. The backport is clean and low risk.</comment>
                            <comment id="14766554" author="mbaesken" created="Thu, 3 Apr 2025 00:10:07 -0700"  >jdk24u backport request&lt;br/&gt;
I would like to have the patch in jdk24u as well, because it would be helpful there too.  The backport is clean and low risk.</comment>
                            <comment id="14766351" author="roboduke" created="Wed, 2 Apr 2025 08:17:42 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk24u/pull/176&quot;&gt;https://git.openjdk.org/jdk24u/pull/176&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-02 15:08:34 +0000</comment>
                            <comment id="14758469" author="dukebot" created="Thu, 6 Mar 2025 00:12:40 -0800"  >Changeset: 40f150d3&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Matthias Baesken &amp;lt;&lt;a href=&apos;mailto:mbaesken@openjdk.org&apos;&gt;mbaesken@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2025-03-06 08:10:23 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/40f150d3e50caf44fa4a31b79fbcd234142803ce&quot;&gt;https://git.openjdk.org/jdk/commit/40f150d3e50caf44fa4a31b79fbcd234142803ce&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14742544" author="roboduke" created="Thu, 23 Jan 2025 01:29:18 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/23255&quot;&gt;https://git.openjdk.org/jdk/pull/23255&lt;/a&gt;&lt;br/&gt;
Date: 2025-01-23 09:23:52 +0000</comment>
                            <comment id="14742200" author="mbaesken" created="Wed, 22 Jan 2025 03:57:11 -0800"  >Seems there is no change to this coding intended so I suggest to exclude the 2 functions from ubsan-checking :&lt;br/&gt;
&lt;br/&gt;
diff --git a/src/java.desktop/share/native/libawt/java2d/loops/TransformHelper.c b/src/java.desktop/share/native/libawt/java2d/loops/TransformHelper.c&lt;br/&gt;
index 02c99ea9ada..a775fe7cd5d 100644&lt;br/&gt;
--- a/src/java.desktop/share/native/libawt/java2d/loops/TransformHelper.c&lt;br/&gt;
+++ b/src/java.desktop/share/native/libawt/java2d/loops/TransformHelper.c&lt;br/&gt;
@@ -33,6 +33,8 @@&lt;br/&gt;
&amp;nbsp;#include &amp;quot;sun_java2d_loops_TransformHelper.h&amp;quot;&lt;br/&gt;
&amp;nbsp;#include &amp;quot;java_awt_image_AffineTransformOp.h&amp;quot;&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
+#include &amp;quot;ub.h&amp;quot;&lt;br/&gt;
+&lt;br/&gt;
&amp;nbsp;/*&lt;br/&gt;
&amp;nbsp;&amp;nbsp;* The stub functions replace the bilinear and bicubic interpolation&lt;br/&gt;
&amp;nbsp;&amp;nbsp;* functions with NOP versions so that the performance of the helper&lt;br/&gt;
@@ -661,6 +663,8 @@ Transform_SafeHelper(JNIEnv *env,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;((jubyte *)pRes)[comp] = (jubyte) ((cR + (1&amp;lt;&amp;lt;15)) &amp;gt;&amp;gt; 16); \&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} while (0)&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
+/* TransformHelper.c:683:16: runtime error: signed integer overflow: 1932735277 + 429496729 cannot be represented in type &amp;#39;int&amp;#39; */&lt;br/&gt;
+ATTRIBUTE_NO_UBSAN&lt;br/&gt;
&amp;nbsp;static void&lt;br/&gt;
&amp;nbsp;BilinearInterp(jint *pRGB, jint numpix,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;jint xfract, jint dxfract,&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
diff --git a/src/java.desktop/share/native/libawt/java2d/pipe/ShapeSpanIterator.c b/src/java.desktop/share/native/libawt/java2d/pipe/ShapeSpanIterator.c&lt;br/&gt;
index 333231c508f..1240a93b95d 100644&lt;br/&gt;
--- a/src/java.desktop/share/native/libawt/java2d/pipe/ShapeSpanIterator.c&lt;br/&gt;
+++ b/src/java.desktop/share/native/libawt/java2d/pipe/ShapeSpanIterator.c&lt;br/&gt;
@@ -39,6 +39,8 @@&lt;br/&gt;
&amp;nbsp;#include &amp;quot;sun_java2d_pipe_ShapeSpanIterator.h&amp;quot;&lt;br/&gt;
&amp;nbsp;#include &amp;quot;java_awt_geom_PathIterator.h&amp;quot;&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
+#include &amp;quot;ub.h&amp;quot;&lt;br/&gt;
+&lt;br/&gt;
&amp;nbsp;/*&lt;br/&gt;
&amp;nbsp;&amp;nbsp;* This structure holds all of the information needed to trace and&lt;br/&gt;
&amp;nbsp;&amp;nbsp;* manage a single line segment of the shape&amp;#39;s outline.&lt;br/&gt;
@@ -1243,6 +1245,8 @@ ShapeSIIntersectClipBox(JNIEnv *env, void *private,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
+/* ShapeSpanIterator.c:1366:21: runtime error: signed integer overflow: 128253951 + 2118518271 cannot be represented in type &amp;#39;int&amp;#39; */&lt;br/&gt;
+ATTRIBUTE_NO_UBSAN&lt;br/&gt;
&amp;nbsp;static jboolean&lt;br/&gt;
&amp;nbsp;ShapeSINextSpan(void *state, jint spanbox[])&lt;br/&gt;
&amp;nbsp;{</comment>
                            <comment id="14677513" author="mbaesken" created="Thu, 30 May 2024 06:57:05 -0700"  >The other one gives also more details when running with ubsan enabled :&lt;br/&gt;
java/awt/Scrollbar/AquaLFScrollbarTest/ScrollBarBorderTest.jtr &lt;br/&gt;
&lt;br/&gt;
jdk/src/java.desktop/share/native/libawt/java2d/loops/TransformHelper.c:683:16: runtime error: signed integer overflow: 1651910497 + 660764199 cannot be represented in type &amp;#39;int&amp;#39;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#0 0x7efe59e6ece8 in BilinearInterp src/java.desktop/share/native/libawt/java2d/loops/TransformHelper.c:683&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#1 0x7efe59e75e21 in Java_sun_java2d_loops_TransformHelper_Transform src/java.desktop/share/native/libawt/java2d/loops/TransformHelper.c:499&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#2 0x7efe9b8dee7b  (&amp;lt;unknown module&amp;gt;)</comment>
                            <comment id="14677510" author="mbaesken" created="Thu, 30 May 2024 06:52:45 -0700"  >I get the same ShapeSpanIterator report from binaries with ubsan enabled (on Linuxx86_64 fastdebug). This provides more details.&lt;br/&gt;
java/awt/BasicStroke/DashStrokeTest.jtr&lt;br/&gt;
&lt;br/&gt;
src/java.desktop/share/native/libawt/java2d/pipe/ShapeSpanIterator.c:1366:21: runtime error: signed integer overflow: 128253951 + 2118518271 cannot be represented in type &amp;#39;int&amp;#39;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#0 0x7fb97d7daf21 in ShapeSINextSpan src/java.desktop/share/native/libawt/java2d/pipe/ShapeSpanIterator.c:1366&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#1 0x7fb97d62fa7e in AnyIntSetSpans src/java.desktop/share/native/libawt/java2d/loops/AnyInt.c:75&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#2 0x7fb97d6a8816 in Java_sun_java2d_loops_FillSpans_FillSpans src/java.desktop/share/native/libawt/java2d/loops/FillSpans.c:92&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#3 0x7fba12d07e7b  (&amp;lt;unknown module&amp;gt;)</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5154867">JDK-8353708</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5155027">JDK-8353852</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17008"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17010"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i361lf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17407"><![CDATA[b14]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="197"><![CDATA[2d]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>