<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Sat Sep 27 10:06:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-6956385] URLConnection.getLastModified() leaks file handles for jar:file and file: URLs</title>
                <link>https://bugs.openjdk.org/browse/JDK-6956385</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>FULL PRODUCT VERSION :&lt;br/&gt;
java version &amp;quot;1.6.0_20&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_20-b02)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 16.3-b01, mixed mode, sharing)&lt;br/&gt;
&lt;br/&gt;
ADDITIONAL OS VERSION INFORMATION :&lt;br/&gt;
Ubuntu 7.04&lt;br/&gt;
Linux coconut 2.6.20-16-server #2 SMP Fri Aug 31 01:01:45 UTC 2007 i686 GNU/Linux&lt;br/&gt;
&lt;br/&gt;
also reproduced on:&lt;br/&gt;
Windows 7 Professional 64-bit&lt;br/&gt;
Microsoft Windows [Version 6.1.7600]&lt;br/&gt;
&lt;br/&gt;
A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
Using the getLastModified() call on a URLConnection for jar:file: or file: URLs causes file handles to remain open. When performing many of these calls in quick succession, the operating system can easily hit the open file handles limit. E.g., on an Ubuntu Linux install, the system-wide open file limit is 1024 by default, out of which a large portion may already be consumed by other processes.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
Open a jar:file: URL connection. E.g. run getClass().getResource(&amp;quot;META-INF/MANIFEST.MF&amp;quot;).openConnection(). This returns a sun.net.&lt;a href=&quot;http://www.protocol.jar.JarURLConnection&quot;&gt;www.protocol.jar.JarURLConnection&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
On this URL connection, run getLastModified().&lt;br/&gt;
&lt;br/&gt;
This runs, in sequence,&lt;br/&gt;
java.net.URLConnection.getHeaderFieldDate(),&lt;br/&gt;
sun.net.&lt;a href=&quot;http://www.protocol.jar.JarURLConnection.getHeaderField(),&quot;&gt;www.protocol.jar.JarURLConnection.getHeaderField(),&lt;/a&gt;&lt;br/&gt;
sun.net.&lt;a href=&quot;http://www.protocol.file.FileURLConnection.getHeaderField(),&quot;&gt;www.protocol.file.FileURLConnection.getHeaderField(),&lt;/a&gt;&lt;br/&gt;
sun.net.&lt;a href=&quot;http://www.protocol.file.FileURLConnection.initializeHeaders(),&quot;&gt;www.protocol.file.FileURLConnection.initializeHeaders(),&lt;/a&gt;&lt;br/&gt;
sun.net.&lt;a href=&quot;http://www.protocol.file.FileURLConnection.connect()&quot;&gt;www.protocol.file.FileURLConnection.connect()&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
This last call, opens a FileInputStream which is not closed, further on.&lt;br/&gt;
&lt;br/&gt;
EXPECTED VERSUS ACTUAL BEHAVIOR :&lt;br/&gt;
EXPECTED -&lt;br/&gt;
The getLastModified() call does not cause a file handle to be opened, or closes it  before returning.&lt;br/&gt;
ACTUAL -&lt;br/&gt;
A file handle remains open.&lt;br/&gt;
&lt;br/&gt;
REPRODUCIBILITY :&lt;br/&gt;
This bug can be reproduced always.&lt;br/&gt;
&lt;br/&gt;
---------- BEGIN SOURCE ----------&lt;br/&gt;
// NOTE: This code snippet should be run on a platform where the &amp;#39;lsof&amp;#39; command is available (e.g. Linux).&lt;br/&gt;
// The problem is present on Windows, but it is not as easy to show the number of open files to expose the problem.&lt;br/&gt;
&lt;br/&gt;
private void exposeFileHandleLeakOnJarUrlConnection() throws InterruptedException, IOException {&lt;br/&gt;
	URL jarUrl = LastModifiedBugExposer.class.getResource(&amp;quot;/META-INF/MANIFEST.MF&amp;quot;);&lt;br/&gt;
&lt;br/&gt;
	printNumberOfOpenFiles(&amp;quot;jar&amp;quot;);&lt;br/&gt;
	for (int i = 0; i &amp;lt; 10; ++i) {&lt;br/&gt;
		jarUrl.openConnection().getLastModified();&lt;br/&gt;
		printNumberOfOpenFiles(&amp;quot;jar&amp;quot;);&lt;br/&gt;
	}&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
private void printNumberOfOpenFiles(String method) throws InterruptedException, IOException {&lt;br/&gt;
	Process process = Runtime.getRuntime().exec(&amp;quot;lsof&amp;quot;);&lt;br/&gt;
	BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));&lt;br/&gt;
	int lines = 0;&lt;br/&gt;
	while (reader.readLine() != null) {&lt;br/&gt;
		++lines;&lt;br/&gt;
	}&lt;br/&gt;
	reader.close();&lt;br/&gt;
	process.waitFor();&lt;br/&gt;
&lt;br/&gt;
	System.out.println(&amp;quot;Number of open files (&amp;quot; + method + &amp;quot;): &amp;quot; + lines);&lt;br/&gt;
}&lt;br/&gt;
---------- END SOURCE ----------&lt;br/&gt;
&lt;br/&gt;
CUSTOMER SUBMITTED WORKAROUND :&lt;br/&gt;
Use the following code to obtain the last modified date of a JAR file:&lt;br/&gt;
new File(((JarURLConnection)conn).getJarFile().getName()).lastModified()&lt;br/&gt;
</description>
                <environment></environment>
        <key id="4221575">JDK-6956385</key>
            <summary>URLConnection.getLastModified() leaks file handles for jar:file and file: URLs</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="michaelm">Michael McMahon</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>webbug</label>
                    </labels>
                <created>Thu, 27 May 2010 06:33:46 -0700</created>
                <updated>Mon, 31 Mar 2025 11:41:02 -0700</updated>
                            <resolved>Wed, 28 Jun 2023 08:37:15 -0700</resolved>
                                    <version>6u10</version>
                    <version>8</version>
                    <version>11</version>
                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14764820" author="roboduke" created="Thu, 27 Mar 2025 14:40:10 -0700"  >[jdk17u-fix-request] Approval Request from Daniel Hu&lt;br/&gt;
Fixes bug with `JarURLConnection` leaking file handles when `FileURLConnection` is used. Applies cleanly. Patched in JDK22, and no known bugs from this change. New regression test fails without the fix, and passes with it. Risk is low given the length of time in mainline and small change.</comment>
                            <comment id="14764818" author="roboduke" created="Thu, 27 Mar 2025 14:29:55 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/3409&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/3409&lt;/a&gt;&lt;br/&gt;
Date: 2025-03-27 18:43:36 +0000</comment>
                            <comment id="14764416" author="roboduke" created="Wed, 26 Mar 2025 11:54:33 -0700"  >[jdk21u-fix-request] Approval Request from Daniel Hu&lt;br/&gt;
Fixes bug with `JarURLConnection` leaking file handles when `FileURLConnection` is used. Applies cleanly. Patched in JDK22, and no known bugs from this change. New regression test fails without the fix, and passes with it. Risk is low given the length of time in mainline and small change.</comment>
                            <comment id="14764411" author="roboduke" created="Wed, 26 Mar 2025 11:32:11 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1546&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1546&lt;/a&gt;&lt;br/&gt;
Date: 2025-03-25 16:40:24 +0000</comment>
                            <comment id="14592545" author="dukebot" created="Wed, 28 Jun 2023 08:37:14 -0700"  >Changeset: 9f98136c&lt;br/&gt;
Author:    Jesse Glick &amp;lt;&lt;a href=&apos;mailto:jglick@cloudbees.com&apos;&gt;jglick@cloudbees.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Michael McMahon &amp;lt;&lt;a href=&apos;mailto:michaelm@openjdk.org&apos;&gt;michaelm@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-28 15:33:37 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/9f98136c3a00ca24d59ffefd58308603b58110c7&quot;&gt;https://git.openjdk.org/jdk/commit/9f98136c3a00ca24d59ffefd58308603b58110c7&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14582698" author="roboduke" created="Thu, 18 May 2023 12:57:12 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12871&quot;&gt;https://git.openjdk.org/jdk/pull/12871&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-04 21:49:20 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5154184">JDK-8353096</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5154414">JDK-8353297</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="4990519">JDK-8224095</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17004"><![CDATA[x86]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10001" key="com.atlassian.jira.plugin.system.customfieldtypes:datetime">
                        <customfieldname>Imported</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 16 Sep 2012 00:55:41 -0700</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10002" key="com.atlassian.jira.plugin.system.customfieldtypes:datetime">
                        <customfieldname>Indexed</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 17 Jul 2012 21:01:09 -0700</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17006"><![CDATA[windows_7]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lfqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>125024</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17314"><![CDATA[b04]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="193"><![CDATA[java.net]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>