<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Thu Sep 25 23:50:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8350412] [21u] AArch64: Ambiguous frame layout leads to incorrect traces in JFR</title>
                <link>https://bugs.openjdk.org/browse/JDK-8350412</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>It was previously pointed &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8323755?focusedId=14640270&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14640270&quot;&gt;https://bugs.openjdk.org/browse/JDK-8323755?focusedId=14640270&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14640270&lt;/a&gt; that &amp;quot;When doing a runtime call from compiled code, JVM puts two words onto the stack: ... This breaks the invariant the stack walker relies on: the size of the compiled frame is constant&amp;quot;.&lt;br/&gt;
&lt;br/&gt;
As a result JFR recordings from a simple program from &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8323755&quot; title=&quot;JFR fails to get a stack trace of System.currentTimeMillis() on AArch64&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8323755&quot;&gt;JDK-8323755&lt;/a&gt; do contain wrong samples, e.g. see duplicated timeLoop() entry&lt;br/&gt;
&lt;br/&gt;
jdk.ExecutionSample {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;startTime = 21:33:04.331 (2025-02-19)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;sampledThread = &amp;quot;timeLoop&amp;quot; (javaThreadId = 39)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;state = &amp;quot;STATE_RUNNABLE&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;stackTrace = [&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Test.time() line: 29&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Test.wrapper() line: 25&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Test.timeLoop() line: 15&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Test.timeLoop() line: 20&lt;br/&gt;
&amp;nbsp;&amp;nbsp;]&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
Other diagnostic tools are affected too.&lt;br/&gt;
&lt;br/&gt;
Current code in 21u that is responsible for that is &lt;a href=&quot;https://github.com/openjdk/jdk21u-dev/blob/990859cc32776e2d794de539190c9ccced1dfcd9/src/hotspot/cpu/aarch64/aarch64.ad#L3779&quot;&gt;https://github.com/openjdk/jdk21u-dev/blob/990859cc32776e2d794de539190c9ccced1dfcd9/src/hotspot/cpu/aarch64/aarch64.ad#L3779&lt;/a&gt;&lt;br/&gt;
It&amp;#39;s the same for other update releases.&lt;br/&gt;
&lt;br/&gt;
In mainline jdk the issue has been fixed in JDK 24 as a part of JEP 491: Synchronize Virtual Threads without Pinning (&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8338383&quot; title=&quot;Implement JEP 491: Synchronize Virtual Threads without Pinning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8338383&quot;&gt;&lt;strike&gt;JDK-8338383&lt;/strike&gt;&lt;/a&gt;).&lt;br/&gt;
&lt;br/&gt;
The fix is in the aarch64.ad changes:&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/commit/78b80150e009745b8f28d36c3836f18ad0ca921f#diff-018aa61d1a7aafcf70a535fcd40a318a4bd6511fd40ac39ce4be90cc52216749R1651&quot;&gt;https://github.com/openjdk/jdk/commit/78b80150e009745b8f28d36c3836f18ad0ca921f#diff-018aa61d1a7aafcf70a535fcd40a318a4bd6511fd40ac39ce4be90cc52216749R1651&lt;/a&gt;</description>
                <environment></environment>
        <key id="5151069">JDK-8350412</key>
            <summary>[21u] AArch64: Ambiguous frame layout leads to incorrect traces in JFR</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dchuyko">Dmitry Chuyko</assignee>
                                    <reporter username="dchuyko">Dmitry Chuyko</reporter>
                        <labels>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jfr</label>
                            <label>sustaining</label>
                    </labels>
                <created>Thu, 20 Feb 2025 02:09:31 -0800</created>
                <updated>Tue, 29 Apr 2025 23:16:35 -0700</updated>
                            <resolved>Wed, 19 Mar 2025 15:08:32 -0700</resolved>
                                    <version>8</version>
                    <version>11</version>
                    <version>17</version>
                    <version>21</version>
                                    <fixVersion>21.0.8</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14774991" author="dukebot" created="Tue, 29 Apr 2025 23:12:54 -0700"  >Changeset: 47aafc24&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Dmitry Chuyko &amp;lt;&lt;a href=&apos;mailto:dchuyko@openjdk.org&apos;&gt;dchuyko@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Paul Hohensee &amp;lt;&lt;a href=&apos;mailto:phh@openjdk.org&apos;&gt;phh@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2025-03-19 22:06:30 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk21u/commit/47aafc24dfd6c62e80ff0bb51ce7f08f90e1bbe5&quot;&gt;https://git.openjdk.org/jdk21u/commit/47aafc24dfd6c62e80ff0bb51ce7f08f90e1bbe5&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14762554" author="roboduke" created="Thu, 20 Mar 2025 08:42:29 -0700"  >[jdk17u-fix-request] Approval Request from Dmitry Chuyko&lt;br/&gt;
This is a tiny fixes of incorrect stack traces sometimes reported by JFR. It is a backport from jdk21u where the change was cherry-picked from 25. In principal the patch for 17u is similar to 21u.&lt;br/&gt;
&lt;br/&gt;
Testing: tier1,2 on linux-aarch64.</comment>
                            <comment id="14762425" author="roboduke" created="Thu, 20 Mar 2025 02:14:13 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/3389&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/3389&lt;/a&gt;&lt;br/&gt;
Date: 2025-03-20 09:09:32 +0000</comment>
                            <comment id="14762278" author="dukebot" created="Wed, 19 Mar 2025 15:08:31 -0700"  >Changeset: 47aafc24&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Dmitry Chuyko &amp;lt;&lt;a href=&apos;mailto:dchuyko@openjdk.org&apos;&gt;dchuyko@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Paul Hohensee &amp;lt;&lt;a href=&apos;mailto:phh@openjdk.org&apos;&gt;phh@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2025-03-19 22:06:30 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/commit/47aafc24dfd6c62e80ff0bb51ce7f08f90e1bbe5&quot;&gt;https://git.openjdk.org/jdk21u-dev/commit/47aafc24dfd6c62e80ff0bb51ce7f08f90e1bbe5&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14756078" author="goetz" created="Tue, 25 Feb 2025 02:28:31 -0800"  >[~dchuyko], please backport to 24 first. -- Ah, ok, I get it, it is released in the JEP in 24.</comment>
                            <comment id="14755896" author="roboduke" created="Mon, 24 Feb 2025 11:47:47 -0800"  >[jdk21u-fix-request] Approval Request from Dmitry Chuyko&lt;br/&gt;
This change fixes the stack layout that leads to non-deterministic stack walking, which at least turns into incorrect traces reported by JFR, other profiling tools also loose samples or require special workarounds.&lt;br/&gt;
&lt;br/&gt;
It is technically a clean backport of a tiny aarch64.ad change cherry picked from JEP 491. With a constant frame size JFR stops reporting incorrect traces on aarch64.&lt;br/&gt;
&lt;br/&gt;
In a case of approval I&amp;#39;ll defer the integration to 21u till JDK 24 is out (or a defer label can be used).</comment>
                            <comment id="14755225" author="roboduke" created="Thu, 20 Feb 2025 04:13:50 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/1418&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/1418&lt;/a&gt;&lt;br/&gt;
Date: 2025-02-20 12:09:51 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5154709">JDK-8353563</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5118945">JDK-8323755</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5136791">JDK-8338383</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19300"><![CDATA[aarch64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39wzf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17304"><![CDATA[b01]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>